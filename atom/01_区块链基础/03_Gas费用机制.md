# Gas è´¹ç”¨æœºåˆ¶

> Web3 å¼€å‘å¿…å¤‡çŸ¥è¯† | åŒºå—é“¾åŸºç¡€ | å‰ç«¯å·¥ç¨‹å¸ˆå‹å¥½

---

## 1. ã€30å­—æ ¸å¿ƒã€‘

**Gasæ˜¯ä»¥å¤ªåŠäº¤æ˜“çš„è®¡ç®—è´¹ç”¨å•ä½ï¼Œé€šè¿‡Gas Priceå’ŒGas Limitæ§åˆ¶äº¤æ˜“æˆæœ¬ï¼Œæ˜¯é˜²æ­¢ç½‘ç»œæ»¥ç”¨å’Œæ¿€åŠ±éªŒè¯è€…çš„æ ¸å¿ƒæœºåˆ¶ã€‚**

---

## 2. ã€ç¬¬ä¸€æ€§åŸç†ã€‘

### ä»€ä¹ˆæ˜¯ç¬¬ä¸€æ€§åŸç†ï¼Ÿ

**ç¬¬ä¸€æ€§åŸç†**ï¼šå›åˆ°äº‹ç‰©æœ€åŸºæœ¬çš„çœŸç†ï¼Œä»æºå¤´æ€è€ƒé—®é¢˜

### Gasè´¹ç”¨æœºåˆ¶çš„ç¬¬ä¸€æ€§åŸç† ğŸ¯

#### 1. æœ€åŸºç¡€çš„å®šä¹‰

**Gas = è®¡ç®—èµ„æºçš„è®¡é‡å•ä½**

å°±åƒæ±½è½¦éœ€è¦æ±½æ²¹æ‰èƒ½è·‘ï¼Œä»¥å¤ªåŠçš„æ¯ä¸ªæ“ä½œéƒ½éœ€è¦æ¶ˆè€—"ç‡ƒæ–™"ï¼ˆGasï¼‰æ‰èƒ½æ‰§è¡Œã€‚

ä»…æ­¤è€Œå·²ï¼æ²¡æœ‰æ›´åŸºç¡€çš„äº†ã€‚

#### 2. ä¸ºä»€ä¹ˆéœ€è¦Gasï¼Ÿ

**æ ¸å¿ƒé—®é¢˜ï¼šå¦‚ä½•åœ¨å»ä¸­å¿ƒåŒ–ç½‘ç»œä¸­å…¬å¹³åˆ†é…æœ‰é™çš„è®¡ç®—èµ„æºï¼Ÿ**

æƒ³è±¡ä¸€ä¸‹ï¼š
- ä»¥å¤ªåŠæ˜¯ä¸€å°"ä¸–ç•Œè®¡ç®—æœº"
- å…¨çƒæˆåƒä¸Šä¸‡çš„èŠ‚ç‚¹åŒæ—¶è¿è¡Œ
- æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦æ‰§è¡Œç›¸åŒçš„è®¡ç®—
- è®¡ç®—èµ„æºæ˜¯æœ‰é™çš„ï¼ˆCPUã€å†…å­˜ã€å­˜å‚¨ï¼‰

å¦‚æœæ²¡æœ‰Gasæœºåˆ¶ï¼š
- ä»»ä½•äººéƒ½å¯ä»¥å†™æ— é™å¾ªç¯ä»£ç ï¼Œè®©ç½‘ç»œç˜«ç—ª
- æ¶æ„æ”»å‡»è€…å¯ä»¥é›¶æˆæœ¬å‘èµ·DoSæ”»å‡»
- éªŒè¯è€…æ²¡æœ‰åŠ¨åŠ›å¤„ç†äº¤æ˜“

#### 3. Gasçš„ä¸‰å±‚ä»·å€¼

##### ä»·å€¼1ï¼šé˜²æ­¢æ»¥ç”¨ï¼ˆå®‰å…¨é˜²çº¿ï¼‰
æ¯ä¸ªæ“ä½œéƒ½æœ‰æˆæœ¬ï¼Œè®©æ¶æ„æ”»å‡»å˜å¾—æ˜‚è´µã€‚

```
æ— é™å¾ªç¯æ”»å‡» â†’ éœ€è¦æ— é™Gas â†’ éœ€è¦æ— é™èµ„é‡‘ â†’ æ”»å‡»ä¸å¯è¡Œ
```

##### ä»·å€¼2ï¼šæ¿€åŠ±éªŒè¯è€…ï¼ˆç»æµæ¨¡å‹ï¼‰
éªŒè¯è€…æ¶ˆè€—ç”µåŠ›å’Œç®—åŠ›å¤„ç†äº¤æ˜“ï¼ŒGasè´¹æ˜¯ä»–ä»¬çš„æŠ¥é…¬ã€‚

```
ç”¨æˆ·æ”¯ä»˜Gasè´¹ â†’ éªŒè¯è€…è·å¾—æ”¶ç›Š â†’ ç»´æŒç½‘ç»œè¿è½¬
```

##### ä»·å€¼3ï¼šèµ„æºå®šä»·ï¼ˆå¸‚åœºæœºåˆ¶ï¼‰
é€šè¿‡ä»·æ ¼å‘ç°æœºåˆ¶ï¼Œè®©æœ€éœ€è¦çš„äº¤æ˜“ä¼˜å…ˆè¢«å¤„ç†ã€‚

```
ç´§æ€¥äº¤æ˜“ â†’ æ„¿æ„æ”¯ä»˜æ›´é«˜Gas â†’ ä¼˜å…ˆè¢«æ‰“åŒ…
```

#### 4. ä»ç¬¬ä¸€æ€§åŸç†æ¨å¯¼ä»¥å¤ªåŠGasè®¾è®¡

**æ¨ç†é“¾ï¼š**

```
1. ä»¥å¤ªåŠæ˜¯å»ä¸­å¿ƒåŒ–è®¡ç®—å¹³å°
   â†“
2. è®¡ç®—èµ„æºæ˜¯æœ‰é™çš„
   â†“
3. éœ€è¦ä¸€ç§æ–¹å¼è¡¡é‡è®¡ç®—æ¶ˆè€—
   â†“
4. å¼•å…¥Gasä½œä¸ºè®¡é‡å•ä½ï¼ˆä¸åŒæ“ä½œæ¶ˆè€—ä¸åŒGasï¼‰
   â†“
5. éœ€è¦é˜²æ­¢æ— é™è®¡ç®—
   â†“
6. å¼•å…¥Gas Limitï¼ˆå•ç¬”äº¤æ˜“çš„ç‡ƒæ–™ä¸Šé™ï¼‰
   â†“
7. éœ€è¦æ¿€åŠ±éªŒè¯è€…å¤„ç†äº¤æ˜“
   â†“
8. å¼•å…¥Gas Priceï¼ˆç”¨æˆ·æ„¿æ„æ”¯ä»˜çš„å•ä»·ï¼‰
   â†“
9. äº¤æ˜“è´¹ = Gas Used Ã— Gas Price
   â†“
10. ç½‘ç»œæ‹¥å µæ—¶ä»·æ ¼è‡ªåŠ¨è°ƒèŠ‚ï¼ˆEIP-1559ï¼‰
```

#### 5. ä¸€å¥è¯æ€»ç»“ç¬¬ä¸€æ€§åŸç†

**Gasæ˜¯ä»¥å¤ªåŠçš„"ç‡ƒæ–™"ï¼Œé€šè¿‡ä¸ºè®¡ç®—å®šä»·å®ç°èµ„æºåˆ†é…ã€é˜²æ­¢æ»¥ç”¨ã€æ¿€åŠ±éªŒè¯è€…ä¸‰å¤§ç›®æ ‡ã€‚**

---

## 3. ã€3ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‘

### æ ¸å¿ƒæ¦‚å¿µ1ï¼šGas Limitï¼ˆç‡ƒæ–™ä¸Šé™ï¼‰ğŸ”¢

**Gas Limitæ˜¯ä½ æ„¿æ„ä¸ºä¸€ç¬”äº¤æ˜“æ”¯ä»˜çš„æœ€å¤§Gasæ•°é‡ï¼Œç›¸å½“äº"é¢„ç®—ä¸Šé™"ã€‚**

```javascript
// Gas Limit çš„ä½œç”¨ç¤ºä¾‹
const transaction = {
  to: "0x...",
  value: ethers.parseEther("1.0"),
  gasLimit: 21000  // æœ€å¤šæ¶ˆè€—21000 Gas
};

// ç®€å•ETHè½¬è´¦å›ºå®šæ¶ˆè€— 21000 Gas
// æ™ºèƒ½åˆçº¦è°ƒç”¨é€šå¸¸éœ€è¦æ›´å¤šï¼Œå¦‚ 100000-500000
```

**è¯¦ç»†è§£é‡Šï¼š**
- **å¤ªä½**ï¼šäº¤æ˜“æ‰§è¡Œåˆ°ä¸€åŠGasè€—å°½ï¼Œäº¤æ˜“å¤±è´¥ï¼ˆrevertï¼‰ï¼Œä½†Gasè´¹ä¸é€€è¿˜ï¼
- **å¤ªé«˜**ï¼šæ²¡å…³ç³»ï¼Œç”¨ä¸å®Œçš„ä¼šé€€è¿˜
- **é»˜è®¤å€¼**ï¼šé’±åŒ…ä¼šè‡ªåŠ¨ä¼°ç®—ï¼Œä½†å¤æ‚äº¤æ˜“å¯èƒ½ä¼°ç®—ä¸å‡†

**åœ¨åŒºå—é“¾/DAppå¼€å‘ä¸­çš„åº”ç”¨ï¼š**
- DAppå¼€å‘æ—¶éœ€è¦åˆç†è®¾ç½®Gas Limitï¼Œé¿å…ç”¨æˆ·äº¤æ˜“å¤±è´¥
- å¤æ‚åˆçº¦è°ƒç”¨è¦é¢„ç•™è¶³å¤Ÿä½™é‡ï¼ˆé€šå¸¸æ˜¯ä¼°ç®—å€¼çš„1.2-1.5å€ï¼‰

---

### æ ¸å¿ƒæ¦‚å¿µ2ï¼šGas Price / Base Fee / Priority Feeï¼ˆç‡ƒæ–™ä»·æ ¼ï¼‰ğŸ’°

**Gas Priceæ˜¯æ¯å•ä½Gasçš„ä»·æ ¼ï¼Œå†³å®šäº†äº¤æ˜“çš„æ€»æˆæœ¬å’Œå¤„ç†ä¼˜å…ˆçº§ã€‚**

#### EIP-1559 ä¹‹å‰ï¼ˆLegacyï¼‰

```javascript
// æ—§æ¨¡å¼ï¼šç®€å•ç²—æš´
const legacyTx = {
  gasPrice: ethers.parseUnits("20", "gwei"), // æ¯Gas 20 Gwei
  gasLimit: 21000
};
// æ€»è´¹ç”¨ = 20 Gwei Ã— 21000 = 420000 Gwei = 0.00042 ETH
```

#### EIP-1559 ä¹‹åï¼ˆæ¨èï¼‰

```javascript
// æ–°æ¨¡å¼ï¼šBase Fee + Priority Fee
const eip1559Tx = {
  maxFeePerGas: ethers.parseUnits("30", "gwei"),      // æœ€é«˜å•ä»·
  maxPriorityFeePerGas: ethers.parseUnits("2", "gwei"), // å°è´¹
  gasLimit: 21000
};
// Base Fee: ç”±åè®®è‡ªåŠ¨è®¡ç®—ï¼ˆæ ¹æ®ç½‘ç»œæ‹¥å µç¨‹åº¦ï¼‰
// Priority Fee: ç»™éªŒè¯è€…çš„å°è´¹ï¼ˆè¶Šé«˜è¶Šå¿«ï¼‰
// å®é™…è´¹ç”¨ = (Base Fee + Priority Fee) Ã— Gas Used
```

**å•ä½æ¢ç®—ï¼š**
```
1 ETH = 10^9 Gwei = 10^18 Wei
1 Gwei = 10^9 Wei
```

**åœ¨åŒºå—é“¾/DAppå¼€å‘ä¸­çš„åº”ç”¨ï¼š**
- ç´§æ€¥äº¤æ˜“ï¼šæé«˜ maxPriorityFeePerGas
- çœé’±äº¤æ˜“ï¼šé™ä½ maxFeePerGasï¼Œç­‰å¾…ä½å³°æœŸ
- DAppè¦å®æ—¶è·å–Gasä»·æ ¼ï¼Œç»™ç”¨æˆ·å±•ç¤ºé¢„ä¼°è´¹ç”¨

---

### æ ¸å¿ƒæ¦‚å¿µ3ï¼šGas Usedï¼ˆå®é™…æ¶ˆè€—ï¼‰â›½

**Gas Usedæ˜¯äº¤æ˜“å®é™…æ¶ˆè€—çš„Gasæ•°é‡ï¼Œå–å†³äºæ‰§è¡Œäº†å“ªäº›æ“ä½œã€‚**

```javascript
// ä¸åŒæ“ä½œçš„Gasæ¶ˆè€—ï¼ˆå¤§çº¦å€¼ï¼‰
const GAS_COSTS = {
  // åŸºç¡€æ“ä½œ
  TRANSFER: 21000,           // ç®€å•ETHè½¬è´¦
  
  // å­˜å‚¨æ“ä½œï¼ˆæœ€è´µï¼ï¼‰
  SSTORE_NEW: 20000,         // å­˜å‚¨æ–°å€¼
  SSTORE_UPDATE: 5000,       // æ›´æ–°å·²æœ‰å€¼
  SSTORE_CLEAR: -15000,      // æ¸…é›¶ï¼ˆé€€è¿˜Gasï¼‰
  
  // è®¡ç®—æ“ä½œ
  ADD: 3,                    // åŠ æ³•
  MUL: 5,                    // ä¹˜æ³•
  
  // åˆçº¦è°ƒç”¨
  CALL: 700,                 // è°ƒç”¨å…¶ä»–åˆçº¦ï¼ˆåŸºç¡€ï¼‰
  CREATE: 32000,             // åˆ›å»ºæ–°åˆçº¦
};

// ERC20è½¬è´¦å¤§çº¦æ¶ˆè€— 45000-65000 Gas
// Uniswap Swap å¤§çº¦æ¶ˆè€— 100000-300000 Gas
```

**è´¹ç”¨è®¡ç®—å…¬å¼ï¼š**
```
å®é™…è´¹ç”¨ = Gas Used Ã— Effective Gas Price
å¤šä»˜çš„ = (Gas Limit - Gas Used) Ã— Gas Price â†’ é€€è¿˜
```

**åœ¨åŒºå—é“¾/DAppå¼€å‘ä¸­çš„åº”ç”¨ï¼š**
- **Gasä¼˜åŒ–**ï¼šæ™ºèƒ½åˆçº¦å¼€å‘çš„æ ¸å¿ƒæŠ€èƒ½
- å‡å°‘å­˜å‚¨æ“ä½œï¼ˆSSTOREæœ€è´µï¼‰
- ä½¿ç”¨ `calldata` æ›¿ä»£ `memory`
- æ‰¹é‡æ“ä½œæ›¿ä»£å¤šæ¬¡å•ç‹¬è°ƒç”¨

---

## 4. ã€æœ€å°å¯ç”¨ã€‘

æŒæ¡ä»¥ä¸‹å†…å®¹ï¼Œå°±èƒ½å¤„ç†80%çš„Gasç›¸å…³é—®é¢˜ï¼š

### 4.1 ä¼°ç®—Gasè´¹ç”¨

```javascript
import { ethers } from 'ethers';

// è¿æ¥åˆ°ä»¥å¤ªåŠèŠ‚ç‚¹
const provider = new ethers.JsonRpcProvider('https://eth-mainnet.g.alchemy.com/v2/YOUR_KEY');

// 1. è·å–å½“å‰Gasä»·æ ¼
async function getGasPrice() {
  const feeData = await provider.getFeeData();
  console.log("å½“å‰Gasä»·æ ¼:");
  console.log("  Base Fee:", ethers.formatUnits(feeData.gasPrice, "gwei"), "Gwei");
  console.log("  Max Fee:", ethers.formatUnits(feeData.maxFeePerGas, "gwei"), "Gwei");
  console.log("  Priority Fee:", ethers.formatUnits(feeData.maxPriorityFeePerGas, "gwei"), "Gwei");
  return feeData;
}

// 2. ä¼°ç®—äº¤æ˜“Gas
async function estimateGas(to, data) {
  const gasLimit = await provider.estimateGas({
    to: to,
    data: data
  });
  console.log("é¢„ä¼°Gas Limit:", gasLimit.toString());
  return gasLimit;
}
```

### 4.2 å‘é€äº¤æ˜“æ—¶è®¾ç½®Gas

```javascript
// å‘é€ETHè½¬è´¦
async function sendETH(signer, to, amount) {
  const tx = await signer.sendTransaction({
    to: to,
    value: ethers.parseEther(amount),
    // EIP-1559 å‚æ•°ï¼ˆæ¨èï¼‰
    maxFeePerGas: ethers.parseUnits("50", "gwei"),
    maxPriorityFeePerGas: ethers.parseUnits("2", "gwei"),
    // æˆ–è€…è®©é’±åŒ…è‡ªåŠ¨ä¼°ç®—ï¼Œä¸è®¾ç½®è¿™äº›å‚æ•°
  });
  
  console.log("äº¤æ˜“å“ˆå¸Œ:", tx.hash);
  const receipt = await tx.wait();
  console.log("å®é™…æ¶ˆè€—Gas:", receipt.gasUsed.toString());
  console.log("å®é™…è´¹ç”¨:", ethers.formatEther(receipt.fee), "ETH");
}
```

### 4.3 å¸¸è§Gasæ¶ˆè€—é€ŸæŸ¥

| æ“ä½œ | å¤§çº¦Gasæ¶ˆè€— | è´¹ç”¨ä¼°ç®—ï¼ˆ20 Gweiï¼‰ |
|------|------------|-------------------|
| ETHè½¬è´¦ | 21,000 | ~$1 |
| ERC20è½¬è´¦ | 65,000 | ~$3 |
| ERC20 Approve | 45,000 | ~$2 |
| Uniswap Swap | 150,000 | ~$7 |
| NFT Mint | 100,000-300,000 | ~$5-15 |
| åˆçº¦éƒ¨ç½² | 1,000,000+ | ~$50+ |

**è¿™äº›çŸ¥è¯†è¶³ä»¥ï¼š**
- ç†è§£äº¤æ˜“è´¹ç”¨çš„ç»„æˆ
- ä¸ºDAppç”¨æˆ·å±•ç¤ºGasä¼°ç®—
- å¤„ç†äº¤æ˜“å¤±è´¥é—®é¢˜ï¼ˆGasä¸è¶³ï¼‰
- ä¼˜åŒ–äº¤æ˜“å‘é€æ—¶æœº

---

## 5. ã€1ä¸ªç±»æ¯”ã€‘

### ç±»æ¯”1ï¼šGasè´¹ç”¨ = å¿«é€’è´¹ ğŸšš

#### ç”Ÿæ´»åœºæ™¯ç±»æ¯”ï¼šGasè´¹ç”¨ = å¿«é€’è´¹

æƒ³è±¡ä½ è¦å¯„ä¸€ä¸ªå¿«é€’ï¼š

| å¿«é€’ç³»ç»Ÿ | ä»¥å¤ªåŠGasç³»ç»Ÿ |
|---------|--------------|
| å¿«é€’é‡é‡ | Gas Usedï¼ˆæ“ä½œå¤æ‚åº¦ï¼‰ |
| æ¯å…¬æ–¤å•ä»· | Gas Priceï¼ˆæ¯Gasä»·æ ¼ï¼‰ |
| æœ€å¤§é‡é‡é™åˆ¶ | Gas Limitï¼ˆæ„¿æ„æ”¯ä»˜çš„ä¸Šé™ï¼‰ |
| å¿«é€’è´¹ = é‡é‡ Ã— å•ä»· | äº¤æ˜“è´¹ = Gas Used Ã— Gas Price |
| åŠ æ€¥å¿«é€’æ›´è´µ | é«˜Priority Feeæ›´å¿«è¢«æ‰“åŒ… |
| åŒ11å¿«é€’æ¶¨ä»· | ç½‘ç»œæ‹¥å µGas Priceä¸Šæ¶¨ |
| å¿«é€’å‘˜å·¥èµ„ | éªŒè¯è€…è·å¾—çš„Priority Fee |
| åŒ…è£¹è¿½è¸ªå· | äº¤æ˜“å“ˆå¸Œï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰ |

**ä¸¾ä¾‹ï¼ˆ10å²å°æœ‹å‹èƒ½æ‡‚ï¼‰ï¼š**

å‡è®¾ä½ è¦ç»™å¥¶å¥¶å¯„ç”Ÿæ—¥ç¤¼ç‰©ï¼š

1. **å¯„ä¸€å°ä¿¡ï¼ˆè½»ï¼‰= ETHè½¬è´¦**
   - å¿«é€’è´¹ï¼š5å…ƒï¼ˆ21000 Gas Ã— å¾ˆä½å•ä»·ï¼‰
   - å¾ˆç®€å•ï¼Œå¿«é€’å‘˜æ‹¿äº†å°±èµ°

2. **å¯„ä¸€å°å†°ç®±ï¼ˆé‡ï¼‰= å¤æ‚åˆçº¦è°ƒç”¨**
   - å¿«é€’è´¹ï¼š500å…ƒï¼ˆ300000 Gas Ã— å•ä»·ï¼‰
   - éœ€è¦å¤§è´§è½¦ã€æ¬è¿å·¥ï¼Œè´¹ç”¨è‡ªç„¶é«˜

3. **åŒ11æƒ³å¿«ç‚¹é€åˆ° = æé«˜Priority Fee**
   - æ™®é€šå¿«é€’ï¼š3å¤©åˆ°ï¼ˆä½Priority Feeï¼‰
   - åŠ æ€¥å¿«é€’ï¼šæ¬¡æ—¥è¾¾ï¼ˆé«˜Priority Feeï¼‰
   - ä½†å³ä½¿åŠ æ€¥ï¼Œå¿«é€’å‘˜ä¸€å¤©ä¹Ÿåªèƒ½é€æœ‰é™æ•°é‡

4. **å¿«é€’è¶…é‡è¢«æ‹’ = Gas Limitä¸å¤Ÿ**
   - ä½ è¯´"æœ€å¤šä»˜100å…ƒ"ï¼Œä½†å†°ç®±è¦500å…ƒ
   - å¿«é€’å‘˜ç›´æ¥æ‹’æ”¶ï¼ˆäº¤æ˜“å¤±è´¥ï¼‰
   - **è€Œä¸”ä½ çš„100å…ƒä¸é€€ï¼**ï¼ˆè¿™æ˜¯Gasçš„ç‰¹æ®Šæ€§ï¼‰

5. **åŒ…è£¹ä¸­é€”ä¸¢å¤± = äº¤æ˜“revert**
   - å·²ç»èŠ±çš„è¿è´¹ä¸é€€
   - ä½†å•†å“é€€å›ç»™ä½ ï¼ˆçŠ¶æ€å›æ»šï¼‰

**ä¸ºä»€ä¹ˆè¿™ä¸ªç±»æ¯”å‡†ç¡®ï¼Ÿ**
- éƒ½æ˜¯æŒ‰"å·¥ä½œé‡"è®¡è´¹
- éƒ½æœ‰"é¢„ç®—ä¸Šé™"æœºåˆ¶
- éƒ½æœ‰"åŠ æ€¥"é€‰é¡¹æé«˜ä¼˜å…ˆçº§
- éƒ½æœ‰å¸‚åœºå®šä»·æœºåˆ¶ï¼ˆä¾›éœ€å†³å®šä»·æ ¼ï¼‰

---

#### å‰ç«¯é¢†åŸŸç±»æ¯”ï¼šGasè´¹ç”¨ = äº‘å‡½æ•°è®¡è´¹ï¼ˆAWS Lambdaï¼‰

å¦‚æœä½ ç”¨è¿‡AWS Lambdaæˆ–Vercel Functionsï¼ŒGasæœºåˆ¶ä¼šå¾ˆç†Ÿæ‚‰ï¼š

| AWS Lambda | ä»¥å¤ªåŠGas | è¯´æ˜ |
|------------|----------|------|
| æ‰§è¡Œæ—¶é—´ï¼ˆmsï¼‰ | Gas Used | å®é™…æ¶ˆè€—çš„èµ„æº |
| æ¯æ¯«ç§’ä»·æ ¼ | Gas Price | å•ä½èµ„æºçš„æˆæœ¬ |
| è¶…æ—¶é™åˆ¶ï¼ˆtimeoutï¼‰ | Gas Limit | æœ€å¤§å…è®¸æ¶ˆè€— |
| è´¹ç”¨ = æ—¶é—´ Ã— å•ä»· | è´¹ç”¨ = Gas Ã— Price | è®¡è´¹å…¬å¼ç›¸åŒ |
| å†·å¯åŠ¨æ›´è´µ | å­˜å‚¨æ–°å€¼æ›´è´µï¼ˆSSTOREï¼‰ | åˆå§‹åŒ–æˆæœ¬é«˜ |
| å†…å­˜é…ç½®å½±å“ä»·æ ¼ | æ“ä½œç±»å‹å½±å“Gas | èµ„æºç±»å‹å†³å®šæˆæœ¬ |
| å¹¶å‘é™åˆ¶ | åŒºå—Gasä¸Šé™ | æ€»å®¹é‡æœ‰é™ |

**ä»£ç å¯¹æ¯”ï¼š**

```javascript
// === AWS Lambda è®¡è´¹é€»è¾‘ ===
// ä½ çš„äº‘å‡½æ•°æ‰§è¡Œäº†200msï¼Œä½¿ç”¨128MBå†…å­˜
const lambdaCost = {
  executionTime: 200,                    // 200ms
  memorySize: 128,                       // 128MB
  pricePerGBSecond: 0.0000166667,        // æ¯GB-ç§’ä»·æ ¼
  totalCost: (200/1000) * (128/1024) * 0.0000166667  // â‰ˆ $0.000000417
};

// è¶…æ—¶è®¾ç½®
const lambdaConfig = {
  timeout: 30,  // æœ€å¤šæ‰§è¡Œ30ç§’ï¼Œè¶…æ—¶å°±ç»ˆæ­¢
  // ç±»ä¼¼ Gas Limitï¼šè¶…è¿‡å°±å¤±è´¥
};
```

```javascript
// === ä»¥å¤ªåŠ Gas è®¡è´¹é€»è¾‘ ===
import { ethers } from 'ethers';

const ethGasCost = {
  gasUsed: 65000n,                                    // å®é™…æ¶ˆè€—65000 Gas
  gasPrice: ethers.parseUnits("20", "gwei"),          // æ¯Gas 20 Gwei
  totalCost: 65000n * ethers.parseUnits("20", "gwei") // = 0.0013 ETH
};

// Gas Limit è®¾ç½®
const txConfig = {
  gasLimit: 100000,  // æœ€å¤šæ¶ˆè€—10ä¸‡Gasï¼Œè¶…è¿‡å°±revert
  // ç±»ä¼¼ Lambda çš„ timeout
};
```

```solidity
// === Solidity ä¸­çš„ Gas æ¶ˆè€—ç¤ºä¾‹ ===
contract GasComparison {
    uint256 public value;  // å­˜å‚¨å˜é‡
    
    // å†™å…¥æ“ä½œ â‰ˆ Lambdaå†™æ•°æ®åº“
    // æ¶ˆè€—å¤§é‡Gasï¼ˆ~20000+ï¼‰ï¼Œå°±åƒLambdaå†™DynamoDBå¾ˆæ…¢
    function setValue(uint256 _value) public {
        value = _value;  // SSTORE æ“ä½œ
    }
    
    // è¯»å–æ“ä½œ â‰ˆ Lambdaä»å†…å­˜è¯»å–
    // é“¾ä¸‹è°ƒç”¨å…è´¹ï¼Œå°±åƒLambdaæœ¬åœ°å˜é‡è®¿é—®
    function getValue() public view returns (uint256) {
        return value;  // SLOAD æ“ä½œ
    }
    
    // è®¡ç®—æ“ä½œ â‰ˆ Lambda CPUè®¡ç®—
    // ä¾¿å®œï¼Œå°±åƒLambdaçº¯è®¡ç®—å¾ˆå¿«
    function calculate(uint256 a, uint256 b) public pure returns (uint256) {
        return a + b;  // ADD æ“ä½œï¼Œåªè¦3 Gas
    }
}
```

**å…³é”®ç›¸ä¼¼æ€§ï¼š**

```javascript
// Lambda: è¶…æ—¶ä¼šç»ˆæ­¢ï¼Œä½†å·²æ‰§è¡Œçš„æ—¶é—´è¦ä»˜è´¹
// Gas: Out of Gasä¼šrevertï¼Œä½†å·²æ¶ˆè€—çš„Gasä¸é€€è¿˜

// Lambdaç¤ºä¾‹
async function handler() {
  await step1();  // æ‰§è¡Œäº†
  await step2();  // æ‰§è¡Œäº†
  await step3();  // è¿™é‡Œè¶…æ—¶äº†ï¼
  // step1, step2 çš„æ‰§è¡Œæ—¶é—´éƒ½è¦ä»˜è´¹
}

// Solidityç¤ºä¾‹
function complexOperation() public {
  step1();  // æ¶ˆè€—äº†1ä¸‡Gas
  step2();  // æ¶ˆè€—äº†2ä¸‡Gas
  step3();  // è¿™é‡ŒGasä¸å¤Ÿäº†ï¼revert
  // 1ä¸‡ + 2ä¸‡ = 3ä¸‡Gasçš„è´¹ç”¨ç…§ä»˜ï¼Œä½†çŠ¶æ€å›æ»š
}
```

---

### ç±»æ¯”2ï¼šGas Price = é«˜é€Ÿå…¬è·¯æ”¶è´¹ ğŸ›£ï¸

#### ç”Ÿæ´»åœºæ™¯ç±»æ¯”ï¼šEIP-1559 = åŠ¨æ€æ”¶è´¹é«˜é€Ÿå…¬è·¯

æƒ³è±¡ä¸€æ¡æ™ºèƒ½é«˜é€Ÿå…¬è·¯ï¼š

| é«˜é€Ÿå…¬è·¯ | ä»¥å¤ªåŠEIP-1559 |
|---------|---------------|
| åŸºç¡€è¿‡è·¯è´¹ï¼ˆæ”¿åºœå®šï¼‰ | Base Feeï¼ˆåè®®è‡ªåŠ¨è®¡ç®—ï¼‰ |
| å°è´¹ç»™æ”¶è´¹å‘˜ | Priority Feeï¼ˆç»™éªŒè¯è€…ï¼‰ |
| è½¦æµé‡å¤§â†’æ¶¨ä»· | ç½‘ç»œæ‹¥å µâ†’Base Feeä¸Šæ¶¨ |
| è½¦æµé‡å°â†’é™ä»· | ç½‘ç»œç©ºé—²â†’Base Feeä¸‹é™ |
| è¿‡è·¯è´¹æœ€é«˜é™é¢ | maxFeePerGas |
| ETCå¿«é€Ÿé€šé“ | é«˜Priority Feeä¼˜å…ˆæ‰“åŒ… |

**ä¸¾ä¾‹ï¼ˆ10å²å°æœ‹å‹èƒ½æ‡‚ï¼‰ï¼š**

å‡è®¾ä½ è¦å¼€è½¦å»æ¸¸ä¹å›­ï¼š

1. **æ™®é€šæ—¶æ®µï¼ˆç½‘ç»œç©ºé—²ï¼‰**
   - åŸºç¡€è¿‡è·¯è´¹ï¼š10å…ƒï¼ˆBase Feeä½ï¼‰
   - ä½ ä¸èµ¶æ—¶é—´ï¼Œå°±ä»˜10å…ƒæ…¢æ…¢å¼€
   - å¯¹åº”ï¼šä½Gasè´¹æ—¶æœŸï¼ŒBase Feeåªæœ‰5-10 Gwei

2. **èŠ‚å‡æ—¥ï¼ˆç½‘ç»œæ‹¥å µï¼‰**
   - åŸºç¡€è¿‡è·¯è´¹ï¼š50å…ƒï¼ˆBase Feeé«˜ï¼‰
   - ç³»ç»Ÿè‡ªåŠ¨æ¶¨ä»·ï¼Œå‡å°‘è½¦æµ
   - å¯¹åº”ï¼šNFTçƒ­é—¨é“¸é€ ï¼ŒBase Feeé£™åˆ°100+ Gwei

3. **æƒ³æ’é˜Ÿèµ°å¿«è½¦é“ = Priority Fee**
   - åŸºç¡€è¿‡è·¯è´¹50å…ƒ + å¿«è½¦é“è´¹20å…ƒ = 70å…ƒ
   - å¿«è½¦é“è´¹ç»™æ”¶è´¹å‘˜ï¼ˆéªŒè¯è€…ï¼‰
   - åŸºç¡€è¿‡è·¯è´¹é”€æ¯ï¼ˆEIP-1559çš„ETHé”€æ¯ï¼‰

4. **ä½ è®¾ç½®"æœ€å¤šä»˜100å…ƒ" = maxFeePerGas**
   - å¦‚æœ Base Fee + Priority Fee â‰¤ 100ï¼Œä¸Šè·¯
   - å¦‚æœ Base Fee æ¶¨åˆ°120ï¼Œä½ å°±ç­‰ç€ï¼ˆäº¤æ˜“pendingï¼‰

**ä¸ºä»€ä¹ˆè¿™ä¸ªç±»æ¯”å‡†ç¡®ï¼Ÿ**
- Base Feeç”±ç³»ç»Ÿè‡ªåŠ¨è°ƒèŠ‚ï¼ˆä¸æ˜¯ç«ä»·ï¼‰
- Priority Feeæ˜¯å¯é€‰çš„"å°è´¹"
- ä»·æ ¼æ ¹æ®æ‹¥å µç¨‹åº¦åŠ¨æ€å˜åŒ–
- æœ‰æœ€é«˜é™é¢ä¿æŠ¤ç”¨æˆ·

---

#### å‰ç«¯é¢†åŸŸç±»æ¯”ï¼šGas Price = CDNæµé‡è®¡è´¹

| CDNè®¡è´¹ | ä»¥å¤ªåŠGas Price |
|--------|-----------------|
| åŸºç¡€æµé‡è´¹ | Base Fee |
| åŠ é€ŸæœåŠ¡è´¹ | Priority Fee |
| å³°å€¼æ—¶æ®µæ¶¨ä»· | ç½‘ç»œæ‹¥å µæ¶¨ä»· |
| æœˆç»“è´¦å• | äº¤æ˜“æ”¶æ® |
| æµé‡åŒ…ä¸Šé™ | maxFeePerGas |

**ä»£ç å¯¹æ¯”ï¼š**

```javascript
// === CDNæµé‡è®¡è´¹é€»è¾‘ ===
const cdnBilling = {
  baseRatePerGB: 0.08,           // åŸºç¡€æµé‡è´¹ $0.08/GB
  premiumAcceleration: 0.02,     // åŠ é€ŸæœåŠ¡è´¹ $0.02/GBï¼ˆå¯é€‰ï¼‰
  usedGB: 100,                   // ä½¿ç”¨äº†100GB
  
  // è®¡è´¹
  baseCost: 100 * 0.08,          // = $8
  premiumCost: 100 * 0.02,       // = $2ï¼ˆå¦‚æœé€‰äº†åŠ é€Ÿï¼‰
  totalCost: 100 * (0.08 + 0.02) // = $10
};

// === ä»¥å¤ªåŠGas Priceé€»è¾‘ï¼ˆEIP-1559ï¼‰===
const gasBilling = {
  baseFee: 20,                   // åè®®è‡ªåŠ¨è®¡ç®—ï¼š20 Gwei
  priorityFee: 2,                // ç”¨æˆ·è®¾ç½®å°è´¹ï¼š2 Gwei
  gasUsed: 65000,                // ä½¿ç”¨äº†65000 Gas
  
  // è®¡è´¹
  effectiveGasPrice: 20 + 2,     // = 22 Gwei
  totalCost: 65000 * 22,         // = 1,430,000 Gwei = 0.00143 ETH
  
  // è´¹ç”¨å»å‘
  burned: 65000 * 20,            // Base Feeé”€æ¯
  toValidator: 65000 * 2         // Priority Feeç»™éªŒè¯è€…
};
```

---

### ç±»æ¯”3ï¼šGas Used = é¤å…ç‚¹é¤ ğŸ½ï¸

#### ç”Ÿæ´»åœºæ™¯ç±»æ¯”ï¼šä¸åŒæ“ä½œçš„Gasæ¶ˆè€— = é¤å…èœå“ä»·æ ¼

| é¤å… | ä»¥å¤ªåŠ |
|------|-------|
| ç™½ç±³é¥­ï¼ˆç®€å•ï¼‰ | ADDåŠ æ³•ï¼ˆ3 Gasï¼‰ |
| ç‚’é’èœï¼ˆä¸€èˆ¬ï¼‰ | SLOADè¯»å–ï¼ˆ200 Gasï¼‰ |
| çº¢çƒ§è‚‰ï¼ˆå¤æ‚ï¼‰ | SSTOREå­˜å‚¨ï¼ˆ20000 Gasï¼‰ |
| æ»¡æ±‰å…¨å¸­ï¼ˆè±ªåï¼‰ | éƒ¨ç½²åˆçº¦ï¼ˆ1000000+ Gasï¼‰ |
| ç‚¹é¤æ€»ä»· | äº¤æ˜“æ€»Gas |

**ä¸¾ä¾‹ï¼ˆ10å²å°æœ‹å‹èƒ½æ‡‚ï¼‰ï¼š**

å‡è®¾ä½ å»é¤å…åƒé¥­ï¼š

1. **ç®€å•è®¡ç®— = ç‚¹ä¸€ç¢—ç±³é¥­**
   - ä»·æ ¼ï¼š1å…ƒï¼ˆADDåªè¦3 Gasï¼‰
   - å¨å¸ˆè½»æ¾åšå®Œ

2. **è¯»å–æ•°æ® = ç‚¹ä¸€ä»½æ²™æ‹‰**
   - ä»·æ ¼ï¼š10å…ƒï¼ˆSLOADè¦200 Gasï¼‰
   - éœ€è¦ä»å†°ç®±æ‹¿é£Ÿæ

3. **å­˜å‚¨æ•°æ® = ç‚¹ä¸€ä»½çº¢çƒ§è‚‰**
   - ä»·æ ¼ï¼š100å…ƒï¼ˆSSTOREè¦20000 Gasï¼‰
   - éœ€è¦é•¿æ—¶é—´çƒ¹é¥ªï¼Œå ç”¨ç‚‰ç¶

4. **éƒ¨ç½²åˆçº¦ = åŒ…åœºåŠå®´å¸­**
   - ä»·æ ¼ï¼š10000å…ƒï¼ˆCREATEè¦ç™¾ä¸‡Gasï¼‰
   - éœ€è¦æå‰å‡†å¤‡ï¼Œå ç”¨æ•´ä¸ªå¨æˆ¿

**ä¸ºä»€ä¹ˆå­˜å‚¨æœ€è´µï¼Ÿ**
```
å­˜å‚¨ = è®©å…¨çƒæ•°åƒä¸ªèŠ‚ç‚¹æ°¸ä¹…ä¿å­˜ä½ çš„æ•°æ®
å°±åƒè®©å…¨ä¸–ç•Œçš„é¤å…éƒ½å¸®ä½ ä¿å­˜ä¸€ä»½èœè°±
å½“ç„¶è´µï¼
```

---

#### å‰ç«¯é¢†åŸŸç±»æ¯”ï¼šGasæ¶ˆè€— = æ•°æ®åº“æ“ä½œæˆæœ¬

| æ•°æ®åº“æ“ä½œ | ä»¥å¤ªåŠæ“ä½œ | Gasæ¶ˆè€— |
|-----------|-----------|---------|
| å†…å­˜å˜é‡ | Stackæ“ä½œ | æä½ï¼ˆ3 Gasï¼‰ |
| Redisè¯»å– | SLOADè¯»å­˜å‚¨ | ä½ï¼ˆ200 Gasï¼‰ |
| MySQLå†™å…¥ | SSTOREå­˜å‚¨ | é«˜ï¼ˆ20000 Gasï¼‰ |
| åˆ›å»ºæ–°è¡¨ | éƒ¨ç½²åˆçº¦ | æé«˜ï¼ˆ32000+ Gasï¼‰ |

**ä»£ç å¯¹æ¯”ï¼š**

```javascript
// === ä¼ ç»Ÿåç«¯ï¼šä¸åŒæ“ä½œæˆæœ¬ ===
async function backendOperations() {
  // å†…å­˜æ“ä½œï¼ˆå…è´¹ï¼‰
  const a = 1 + 2;              // çº³ç§’çº§ï¼Œå‡ ä¹ä¸è®¡è´¹
  
  // Redisè¯»å–ï¼ˆä¾¿å®œï¼‰
  const cache = await redis.get('key');  // æ¯«ç§’çº§ï¼Œå¾ˆä¾¿å®œ
  
  // MySQLå†™å…¥ï¼ˆè¾ƒè´µï¼‰
  await mysql.insert('table', data);     // 10æ¯«ç§’ï¼Œæœ‰æˆæœ¬
  
  // åˆ›å»ºæ–°è¡¨ï¼ˆå¾ˆè´µï¼‰
  await mysql.createTable('new_table');  // 100æ¯«ç§’ï¼Œæˆæœ¬é«˜
}
```

```solidity
// === Solidityï¼šä¸åŒæ“ä½œçš„Gasæˆæœ¬ ===
contract GasCostDemo {
    uint256 public storedValue;
    
    // çº¯è®¡ç®—ï¼ˆæä¾¿å®œï¼š~100 Gasï¼‰
    function calculate(uint256 a, uint256 b) public pure returns (uint256) {
        return a + b + a * b;  // å…¨éƒ¨åœ¨æ ˆä¸Šæ“ä½œ
    }
    
    // è¯»å–å­˜å‚¨ï¼ˆä¾¿å®œï¼š~200 Gasï¼‰
    function readValue() public view returns (uint256) {
        return storedValue;  // SLOAD
    }
    
    // å†™å…¥å­˜å‚¨ï¼ˆè´µï¼š~20000 Gasï¼‰
    function writeValue(uint256 val) public {
        storedValue = val;   // SSTORE
    }
    
    // åˆ›å»ºåˆçº¦ï¼ˆéå¸¸è´µï¼š~32000+ Gasï¼‰
    function deployChild() public returns (address) {
        return address(new ChildContract());  // CREATE
    }
}

contract ChildContract {}
```

---

### ç±»æ¯”æ€»ç»“è¡¨

| Gasæ¦‚å¿µ | ç”Ÿæ´»åœºæ™¯ç±»æ¯” | å‰ç«¯é¢†åŸŸç±»æ¯” | æ ¸å¿ƒç›¸ä¼¼æ€§ |
|--------|------------|-------------|-----------|
| **Gas** | ç‡ƒæ–™/å¿«é€’é‡é‡ | CPUæ—¶é—´/æ‰§è¡Œå‘¨æœŸ | è®¡é‡å·¥ä½œé‡ |
| **Gas Limit** | æ²¹ç®±å®¹é‡/é¢„ç®—ä¸Šé™ | Lambdaè¶…æ—¶/èµ„æºé…é¢ | æœ€å¤§å…è®¸æ¶ˆè€— |
| **Gas Price** | æ²¹ä»·/å¿«é€’å•ä»· | äº‘å‡½æ•°å•ä»· | å•ä½æˆæœ¬ |
| **Gas Used** | å®é™…æ²¹è€—/å®é™…é‡é‡ | å®é™…æ‰§è¡Œæ—¶é—´ | å®é™…æ¶ˆè€— |
| **Base Fee** | é«˜é€Ÿå…¬è·¯åŸºç¡€è¿‡è·¯è´¹ | CDNåŸºç¡€æµé‡è´¹ | åè®®å®šä»·ï¼Œè‡ªåŠ¨è°ƒèŠ‚ |
| **Priority Fee** | å¿«è½¦é“è´¹/åŠ æ€¥è´¹ | åŠ é€ŸæœåŠ¡è´¹ | å¯é€‰å°è´¹ï¼Œæé«˜ä¼˜å…ˆçº§ |
| **maxFeePerGas** | æœ€å¤šæ„¿æ„ä»˜å¤šå°‘ | è´¹ç”¨ä¸Šé™ | ç”¨æˆ·ä¿æŠ¤æœºåˆ¶ |
| **Out of Gas** | åŠè·¯æ²¡æ²¹/å¿«é€’è¶…é‡ | Lambdaè¶…æ—¶ | æ‰§è¡Œå¤±è´¥ï¼Œå·²æ¶ˆè€—ä¸é€€ |
| **SSTORE** | çº¢çƒ§è‚‰ï¼ˆéœ€è¦é•¿æ—¶é—´ï¼‰ | MySQLå†™å…¥ | å­˜å‚¨æ“ä½œæœ€è´µ |
| **SLOAD** | æ²™æ‹‰ï¼ˆä»å†°ç®±æ‹¿ï¼‰ | Redisè¯»å– | è¯»å–ç›¸å¯¹ä¾¿å®œ |
| **EIP-1559é”€æ¯** | è¿‡è·¯è´¹ä¸Šäº¤å›½å®¶ | å¹³å°æŠ½æˆé”€æ¯ | å‡å°‘æ€»ä¾›åº”é‡ |

---

## 6. ã€åç›´è§‰ç‚¹ã€‘

### è¯¯åŒº1ï¼šè¯»å–åŒºå—é“¾æ•°æ®ä¹Ÿè¦èŠ±Gasè´¹ âŒ

**ä¸ºä»€ä¹ˆé”™ï¼Ÿ**
- `view` å’Œ `pure` å‡½æ•°åœ¨**é“¾ä¸‹è°ƒç”¨æ—¶å®Œå…¨å…è´¹**
- åªæœ‰å½“äº¤æ˜“å†…éƒ¨è°ƒç”¨è¿™äº›å‡½æ•°æ—¶æ‰æ¶ˆè€—Gas

**ä¸ºä»€ä¹ˆäººä»¬å®¹æ˜“è¿™æ ·é”™ï¼Ÿ**
- å› ä¸ºå†™å…¥ç¡®å®è¦èŠ±é’±ï¼Œå°±ä»¥ä¸ºæ‰€æœ‰æ“ä½œéƒ½è¦èŠ±é’±
- æ··æ·†äº†"é“¾ä¸Šæ‰§è¡Œ"å’Œ"é“¾ä¸‹æŸ¥è¯¢"çš„åŒºåˆ«

**æ­£ç¡®ç†è§£ï¼š**
```javascript
// å…è´¹ï¼é€šè¿‡ provider ç›´æ¥è¯»å–ï¼ˆé“¾ä¸‹æŸ¥è¯¢ï¼‰
const balance = await contract.balanceOf(address);
const name = await contract.name();

// è¿™äº› view å‡½æ•°è°ƒç”¨ä¸ä¼šäº§ç”Ÿäº¤æ˜“ï¼Œä¸èŠ±Gas
// å› ä¸ºåªæ˜¯è¯»å–èŠ‚ç‚¹æœ¬åœ°çš„åŒºå—é“¾çŠ¶æ€
```

```solidity
// Solidity ä¸­çš„ view å‡½æ•°
function balanceOf(address account) public view returns (uint256) {
    return _balances[account];  // å…è´¹è¯»å–
}
```

---

### è¯¯åŒº2ï¼šGas Limitè®¾å¤ªé«˜ä¼šæµªè´¹é’± âŒ

**ä¸ºä»€ä¹ˆé”™ï¼Ÿ**
- **æœªä½¿ç”¨çš„Gasä¼šå…¨é¢é€€è¿˜**
- Gas Limitåªæ˜¯"æœ€å¤§é¢„ç®—"ï¼Œä¸æ˜¯"å®é™…èŠ±è´¹"
- å®é™…è´¹ç”¨ = Gas Used Ã— Gas Price

**ä¸ºä»€ä¹ˆäººä»¬å®¹æ˜“è¿™æ ·é”™ï¼Ÿ**
- ç”Ÿæ´»ä¸­é¢„ç®—ç”¨ä¸å®Œé€šå¸¸ä¹Ÿæ‹¿ä¸å›æ¥
- "Limit"è¿™ä¸ªè¯è®©äººè§‰å¾—æ˜¯ä¼šè¢«æ‰£é™¤çš„

**æ­£ç¡®ç†è§£ï¼š**
```javascript
// å‡è®¾ Gas Limit = 100,000ï¼Œå®é™…ç”¨äº† 65,000
const tx = {
  gasLimit: 100000,  // é¢„ç®—ä¸Šé™
  maxFeePerGas: ethers.parseUnits("20", "gwei")
};

// äº¤æ˜“æ‰§è¡Œåï¼š
// å®é™…æ¶ˆè€—: 65,000 Gas
// é€€è¿˜: 35,000 Gas å¯¹åº”çš„è´¹ç”¨
// ä½ åªä»˜ 65,000 Ã— 20 Gwei çš„é’±
```

**ä½†è¦æ³¨æ„ï¼šGas Limitè®¾å¤ªä½ä¼šå¯¼è‡´äº¤æ˜“å¤±è´¥ï¼Œè€Œä¸”å¤±è´¥çš„äº¤æ˜“Gasä¸é€€è¿˜ï¼**

---

### è¯¯åŒº3ï¼šGas Priceè®¾è¶Šé«˜äº¤æ˜“å°±è¶Šå¿« âŒ

**ä¸ºä»€ä¹ˆé”™ï¼Ÿ**
- é«˜Gas Priceåªæ˜¯**æé«˜è¢«é€‰ä¸­çš„æ¦‚ç‡**ï¼Œä¸æ˜¯ä¿è¯
- ç½‘ç»œæåº¦æ‹¥å µæ—¶ï¼Œå³ä½¿é«˜Gasä¹Ÿå¯èƒ½ç­‰å¾ˆä¹…
- è¿˜è¦çœ‹åŒºå—Gaså®¹é‡é™åˆ¶ï¼ˆæ¯ä¸ªåŒºå—æœ‰ä¸Šé™ï¼‰

**ä¸ºä»€ä¹ˆäººä»¬å®¹æ˜“è¿™æ ·é”™ï¼Ÿ**
- ç±»æ¯”æ‹å–ï¼šå‡ºä»·é«˜å°±èƒ½ä¹°åˆ°
- ä½†åŒºå—é“¾ä¸æ˜¯æ‹å–ï¼Œæ˜¯"å¤Ÿæ ¼å°±èƒ½è¿›"çš„æ± å­

**æ­£ç¡®ç†è§£ï¼š**
```javascript
// EIP-1559 åçš„æ­£ç¡®ç­–ç•¥
const tx = {
  // maxFeePerGas è¦é«˜äº baseFee æ‰ä¼šè¢«è€ƒè™‘
  maxFeePerGas: ethers.parseUnits("50", "gwei"),
  
  // maxPriorityFeePerGas å†³å®šä¼˜å…ˆçº§
  // ä½†å¦‚æœåŒºå—å·²æ»¡ï¼Œå†é«˜ä¹Ÿè¦ç­‰ä¸‹ä¸€ä¸ªåŒºå—
  maxPriorityFeePerGas: ethers.parseUnits("2", "gwei")
};

// æœ€ä½³ç­–ç•¥ï¼š
// 1. æŸ¥çœ‹å½“å‰ baseFee
// 2. maxFeePerGas è®¾ä¸º baseFee Ã— 2ï¼ˆç•™ä½™é‡ï¼‰
// 3. maxPriorityFeePerGas è®¾ä¸º 1-3 Gweiï¼ˆæ­£å¸¸ï¼‰æˆ– 5+ Gweiï¼ˆåŠ æ€¥ï¼‰
```

---

## 7. ã€å®æˆ˜ä»£ç ã€‘

### åŸºç¡€å®ç°ï¼šGasè´¹ç”¨è®¡ç®—ä¸ä¼°ç®—

```javascript
// ===== Gas è´¹ç”¨å®æˆ˜ä»£ç  =====
// è¿è¡Œç¯å¢ƒ: Node.js + ethers.js v6
// å®‰è£…: npm install ethers

import { ethers } from 'ethers';

// ===== 1. è¿æ¥åˆ°ä»¥å¤ªåŠç½‘ç»œ =====
console.log("=== è¿æ¥ä»¥å¤ªåŠç½‘ç»œ ===");

// ä½¿ç”¨å…¬å…±RPCï¼ˆç”Ÿäº§ç¯å¢ƒè¯·ç”¨Alchemy/Infuraï¼‰
const provider = new ethers.JsonRpcProvider(
  'https://eth.llamarpc.com'  // å…è´¹å…¬å…±RPC
);

// ===== 2. è·å–å½“å‰Gasä»·æ ¼ =====
async function getCurrentGasPrice() {
  console.log("\n=== è·å–å½“å‰Gasä»·æ ¼ ===");
  
  const feeData = await provider.getFeeData();
  
  console.log("Gasä»·æ ¼ä¿¡æ¯:");
  console.log("  Legacy Gas Price:", ethers.formatUnits(feeData.gasPrice, "gwei"), "Gwei");
  console.log("  Max Fee Per Gas:", ethers.formatUnits(feeData.maxFeePerGas, "gwei"), "Gwei");
  console.log("  Max Priority Fee:", ethers.formatUnits(feeData.maxPriorityFeePerGas, "gwei"), "Gwei");
  
  return feeData;
}

// ===== 3. ä¼°ç®—äº¤æ˜“Gasæ¶ˆè€— =====
async function estimateTransactionGas() {
  console.log("\n=== ä¼°ç®—äº¤æ˜“Gas ===");
  
  // æ¨¡æ‹Ÿä¸€ç¬”ETHè½¬è´¦
  const tx = {
    to: "0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045", // vitalik.eth
    value: ethers.parseEther("0.001")
  };
  
  const gasLimit = await provider.estimateGas(tx);
  console.log("ETHè½¬è´¦é¢„ä¼°Gas:", gasLimit.toString());
  
  return gasLimit;
}

// ===== 4. è®¡ç®—äº¤æ˜“è´¹ç”¨ =====
async function calculateTransactionFee() {
  console.log("\n=== è®¡ç®—äº¤æ˜“è´¹ç”¨ ===");
  
  const feeData = await provider.getFeeData();
  const gasLimit = 21000n; // ETHè½¬è´¦å›ºå®šæ¶ˆè€—
  
  // Legacy è®¡ç®—æ–¹å¼
  const legacyFee = gasLimit * feeData.gasPrice;
  console.log("Legacyæ–¹å¼è´¹ç”¨:", ethers.formatEther(legacyFee), "ETH");
  
  // EIP-1559 è®¡ç®—æ–¹å¼ï¼ˆæœ€å¤§å¯èƒ½è´¹ç”¨ï¼‰
  const maxFee = gasLimit * feeData.maxFeePerGas;
  console.log("EIP-1559æœ€å¤§è´¹ç”¨:", ethers.formatEther(maxFee), "ETH");
  
  // è½¬æ¢ä¸ºç¾å…ƒï¼ˆå‡è®¾ETHä»·æ ¼2000ç¾å…ƒï¼‰
  const ethPrice = 2000;
  console.log("çº¦åˆç¾å…ƒ:", (parseFloat(ethers.formatEther(maxFee)) * ethPrice).toFixed(4), "USD");
}

// ===== 5. è¯»å–å†å²äº¤æ˜“çš„Gasä¿¡æ¯ =====
async function analyzeTransactionGas(txHash) {
  console.log("\n=== åˆ†æå†å²äº¤æ˜“Gas ===");
  
  // ä½¿ç”¨ä¸€ä¸ªçœŸå®çš„äº¤æ˜“å“ˆå¸Œ
  const receipt = await provider.getTransactionReceipt(txHash);
  const tx = await provider.getTransaction(txHash);
  
  if (receipt && tx) {
    console.log("äº¤æ˜“å“ˆå¸Œ:", txHash);
    console.log("Gas Limit:", tx.gasLimit.toString());
    console.log("Gas Used:", receipt.gasUsed.toString());
    console.log("Gasåˆ©ç”¨ç‡:", (Number(receipt.gasUsed) / Number(tx.gasLimit) * 100).toFixed(2), "%");
    console.log("Effective Gas Price:", ethers.formatUnits(receipt.gasPrice, "gwei"), "Gwei");
    console.log("å®é™…è´¹ç”¨:", ethers.formatEther(receipt.fee), "ETH");
  }
}

// ===== 6. Gasä»·æ ¼ç›‘æ§ =====
async function monitorGasPrice() {
  console.log("\n=== Gasä»·æ ¼ç›‘æ§ï¼ˆæ¯10ç§’æ›´æ–°ï¼‰===");
  
  let count = 0;
  const interval = setInterval(async () => {
    const feeData = await provider.getFeeData();
    const gasPrice = ethers.formatUnits(feeData.gasPrice, "gwei");
    console.log(`[${new Date().toLocaleTimeString()}] Gas Price: ${gasPrice} Gwei`);
    
    count++;
    if (count >= 3) {
      clearInterval(interval);
      console.log("ç›‘æ§ç»“æŸ");
    }
  }, 10000);
}

// ===== ä¸»å‡½æ•° =====
async function main() {
  try {
    await getCurrentGasPrice();
    await estimateTransactionGas();
    await calculateTransactionFee();
    
    // åˆ†æä¸€ä¸ªçœŸå®äº¤æ˜“ï¼ˆVitalikçš„ä¸€ç¬”è½¬è´¦ï¼‰
    await analyzeTransactionGas(
      "0x5c504ed432cb51138bcf09aa5e8a410dd4a1e204ef84bfed1be16dfba1b22060"
    );
    
    // å¯é€‰ï¼šå¯åŠ¨Gasä»·æ ¼ç›‘æ§
    // await monitorGasPrice();
    
  } catch (error) {
    console.error("é”™è¯¯:", error.message);
  }
}

main();
```

**è¿è¡Œè¾“å‡ºç¤ºä¾‹ï¼š**
```
=== è¿æ¥ä»¥å¤ªåŠç½‘ç»œ ===

=== è·å–å½“å‰Gasä»·æ ¼ ===
Gasä»·æ ¼ä¿¡æ¯:
  Legacy Gas Price: 15.234567890 Gwei
  Max Fee Per Gas: 30.469135780 Gwei
  Max Priority Fee: 1.5 Gwei

=== ä¼°ç®—äº¤æ˜“Gas ===
ETHè½¬è´¦é¢„ä¼°Gas: 21000

=== è®¡ç®—äº¤æ˜“è´¹ç”¨ ===
Legacyæ–¹å¼è´¹ç”¨: 0.000319925925690000 ETH
EIP-1559æœ€å¤§è´¹ç”¨: 0.000639851851380000 ETH
çº¦åˆç¾å…ƒ: 1.2797 USD

=== åˆ†æå†å²äº¤æ˜“Gas ===
äº¤æ˜“å“ˆå¸Œ: 0x5c504ed432cb51138bcf09aa5e8a410dd4a1e204ef84bfed1be16dfba1b22060
Gas Limit: 21000
Gas Used: 21000
Gasåˆ©ç”¨ç‡: 100.00 %
Effective Gas Price: 50.0 Gwei
å®é™…è´¹ç”¨: 0.00105 ETH
```

---

### è¿›é˜¶ï¼šSolidity Gasä¼˜åŒ–ç¤ºä¾‹

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.19;

/// @title Gasä¼˜åŒ–ç¤ºä¾‹åˆçº¦
/// @notice å±•ç¤ºå¸¸è§çš„Gasä¼˜åŒ–æŠ€å·§
contract GasOptimization {
    
    // ===== å­˜å‚¨ä¼˜åŒ– =====
    
    // ä¸å¥½ï¼šæ¯ä¸ªå˜é‡ç‹¬å ä¸€ä¸ªå­˜å‚¨æ§½ï¼ˆ32å­—èŠ‚ï¼‰
    // uint256 public a;  // slot 0
    // uint256 public b;  // slot 1
    // uint128 public c;  // slot 2
    
    // å¥½ï¼šæ‰“åŒ…å­˜å‚¨ï¼ˆuint128 + uint128 = ä¸€ä¸ªslotï¼‰
    uint128 public packedA;  // slot 0 (å‰16å­—èŠ‚)
    uint128 public packedB;  // slot 0 (å16å­—èŠ‚)
    
    // ===== æ•°ç»„ä¼˜åŒ– =====
    uint256[] public dynamicArray;
    
    // ä¸å¥½ï¼šæ¯æ¬¡å¾ªç¯éƒ½è¯»å– length
    function sumBad() public view returns (uint256 total) {
        for (uint256 i = 0; i < dynamicArray.length; i++) {
            total += dynamicArray[i];
        }
    }
    
    // å¥½ï¼šç¼“å­˜ length åˆ°å†…å­˜
    function sumGood() public view returns (uint256 total) {
        uint256 len = dynamicArray.length;  // åªè¯»å–ä¸€æ¬¡
        for (uint256 i = 0; i < len; i++) {
            total += dynamicArray[i];
        }
    }
    
    // ===== Calldata vs Memory =====
    
    // ä¸å¥½ï¼šmemory ä¼šå¤åˆ¶æ•°æ®
    function processBad(uint256[] memory data) public pure returns (uint256) {
        return data[0];
    }
    
    // å¥½ï¼šcalldata ç›´æ¥è¯»å–ï¼ˆåªè¯»åœºæ™¯ï¼‰
    function processGood(uint256[] calldata data) public pure returns (uint256) {
        return data[0];
    }
    
    // ===== çŸ­è·¯æ±‚å€¼ =====
    
    // æŠŠä¾¿å®œçš„æ£€æŸ¥æ”¾å‰é¢
    function checkConditions(uint256 value, address addr) public view returns (bool) {
        // value > 0 æ¶ˆè€— 3 Gas
        // addr != address(0) æ¶ˆè€— 3 Gas  
        // å¤æ‚è®¡ç®—æ¶ˆè€—æ›´å¤š
        return value > 0 && addr != address(0) && expensiveCheck(value);
    }
    
    function expensiveCheck(uint256 value) internal pure returns (bool) {
        // æ¨¡æ‹Ÿå¤æ‚è®¡ç®—
        return value % 17 == 0;
    }
    
    // ===== äº‹ä»¶æ›¿ä»£å­˜å‚¨ =====
    
    event DataLogged(address indexed user, uint256 value, uint256 timestamp);
    
    // å¦‚æœæ•°æ®åªéœ€è¦é“¾ä¸‹æŸ¥è¯¢ï¼Œç”¨äº‹ä»¶æ¯”å­˜å‚¨ä¾¿å®œ
    function logData(uint256 value) public {
        emit DataLogged(msg.sender, value, block.timestamp);
        // æ¯”å†™å…¥å­˜å‚¨å˜é‡ä¾¿å®œå¾ˆå¤š
    }
}
```

---

## 8. ã€é¢è¯•å¿…é—®ã€‘

### é—®é¢˜1ï¼š"ä»€ä¹ˆæ˜¯Gasï¼Ÿä¸ºä»€ä¹ˆä»¥å¤ªåŠéœ€è¦Gasæœºåˆ¶ï¼Ÿ"

**æ™®é€šå›ç­”ï¼ˆâŒ ä¸å‡ºå½©ï¼‰ï¼š**
"Gasæ˜¯äº¤æ˜“è´¹ç”¨ï¼Œç”¨æ¥ä»˜ç»™çŸ¿å·¥çš„ã€‚"

**å‡ºå½©å›ç­”ï¼ˆâœ… æ¨èï¼‰ï¼š**

> **Gasæœºåˆ¶æœ‰ä¸‰å±‚å«ä¹‰ï¼š**
>
> 1. **è®¡é‡å•ä½å±‚é¢**ï¼šGasæ˜¯è¡¡é‡è®¡ç®—å¤æ‚åº¦çš„å•ä½ï¼Œä¸åŒæ“ä½œæ¶ˆè€—ä¸åŒGasã€‚æ¯”å¦‚åŠ æ³•æ¶ˆè€—3 Gasï¼Œå­˜å‚¨æ–°å€¼æ¶ˆè€—20000 Gasã€‚è¿™æ ·è®¾è®¡è®©è´¹ç”¨ä¸å®é™…è®¡ç®—é‡æˆæ­£æ¯”ã€‚
>
> 2. **å®‰å…¨é˜²æŠ¤å±‚é¢**ï¼šGasæœºåˆ¶æ˜¯ä»¥å¤ªåŠçš„"å›¾çµå®Œå¤‡æ€æ‰‹"ã€‚å› ä¸ºEVMæ”¯æŒå¾ªç¯å’Œé€’å½’ï¼Œå¦‚æœæ²¡æœ‰Gasé™åˆ¶ï¼Œæ¶æ„ä»£ç å¯ä»¥å†™æ— é™å¾ªç¯è®©ç½‘ç»œç˜«ç—ªã€‚Gas Limitä¿è¯äº†æ¯ç¬”äº¤æ˜“çš„è®¡ç®—é‡æœ‰ä¸Šé™ã€‚
>
> 3. **ç»æµæ¿€åŠ±å±‚é¢**ï¼šGasè´¹ç”¨æ˜¯éªŒè¯è€…çš„æ”¶å…¥æ¥æºã€‚EIP-1559åï¼ŒBase Feeè¢«é”€æ¯ï¼ˆå‡å°‘ETHé€šèƒ€ï¼‰ï¼ŒPriority Feeç»™éªŒè¯è€…ã€‚è¿™åˆ›é€ äº†ä¸€ä¸ªè‡ªæˆ‘è°ƒèŠ‚çš„ç»æµç³»ç»Ÿã€‚
>
> **ä¸ä¼ ç»Ÿäº‘è®¡ç®—çš„åŒºåˆ«**ï¼šä¼ ç»Ÿäº‘è®¡ç®—æŒ‰æ—¶é—´è®¡è´¹ï¼Œä½†ä»¥å¤ªåŠæ˜¯æŒ‰"æ“ä½œç±»å‹"è®¡è´¹ã€‚å› ä¸ºå­˜å‚¨æ“ä½œéœ€è¦æ‰€æœ‰èŠ‚ç‚¹æ°¸ä¹…ä¿å­˜æ•°æ®ï¼Œæ‰€ä»¥æ¯”è®¡ç®—æ“ä½œè´µå¾—å¤šã€‚
>
> **åœ¨å®é™…å·¥ä½œä¸­**ï¼šæˆ‘ä»¬ä¼šå…³æ³¨Gasä¼˜åŒ–ï¼Œæ¯”å¦‚æ‰“åŒ…å­˜å‚¨å˜é‡ã€ç”¨calldataæ›¿ä»£memoryã€ç”¨äº‹ä»¶æ›¿ä»£å­˜å‚¨ã€‚ä¸€ä¸ªä¼˜åŒ–è‰¯å¥½çš„åˆçº¦å¯ä»¥èŠ‚çœ50%ä»¥ä¸Šçš„Gasã€‚

**ä¸ºä»€ä¹ˆè¿™ä¸ªå›ç­”å‡ºå½©ï¼Ÿ**
1. âœ… åˆ†å±‚æ¬¡è§£é‡Šï¼Œå±•ç¤ºç³»ç»Ÿæ€§ç†è§£
2. âœ… ç‚¹å‡º"å›¾çµå®Œå¤‡æ€æ‰‹"è¿™ä¸ªæœ¬è´¨è®¾è®¡ç›®çš„
3. âœ… è”ç³»EIP-1559å’Œç»æµæ¨¡å‹
4. âœ… å¯¹æ¯”ä¼ ç»Ÿè®¡ç®—ï¼Œä½“ç°æ·±åº¦æ€è€ƒ
5. âœ… ç»“åˆå®é™…å·¥ä½œç»éªŒ

---

### é—®é¢˜2ï¼š"EIP-1559æ”¹å˜äº†ä»€ä¹ˆï¼Ÿ"

**æ™®é€šå›ç­”ï¼ˆâŒ ä¸å‡ºå½©ï¼‰ï¼š**
"æŠŠGas Priceæ”¹æˆäº†Base Feeå’ŒPriority Feeã€‚"

**å‡ºå½©å›ç­”ï¼ˆâœ… æ¨èï¼‰ï¼š**

> **EIP-1559å¸¦æ¥äº†ä¸‰ä¸ªæ ¸å¿ƒæ”¹å˜ï¼š**
>
> 1. **è´¹ç”¨å¯é¢„æµ‹æ€§**ï¼šä¹‹å‰ç”¨æˆ·è¦"ç«ä»·"ï¼Œä¸çŸ¥é“è®¾å¤šå°‘åˆé€‚ã€‚ç°åœ¨Base Feeç”±åè®®è‡ªåŠ¨è®¡ç®—ï¼Œç”¨æˆ·åªéœ€å†³å®šæ„¿æ„ä»˜å¤šå°‘Priority Feeï¼ˆå°è´¹ï¼‰ã€‚
>
> 2. **ETHç»æµæ¨¡å‹**ï¼šBase Feeè¢«é”€æ¯è€Œä¸æ˜¯ç»™éªŒè¯è€…ã€‚è¿™æ„å‘³ç€ç½‘ç»œè¶Šå¿™ï¼ŒETHé”€æ¯è¶Šå¤šï¼Œå¯èƒ½é€ æˆé€šç¼©ã€‚è¿™æ˜¯ETHä»"æ•°å­—çŸ³æ²¹"å˜æˆ"æ•°å­—å€ºåˆ¸"çš„å…³é”®ä¸€æ­¥ã€‚
>
> 3. **åŒºå—å¼¹æ€§**ï¼šåŒºå—å¤§å°å¯ä»¥åœ¨ä¸€å®šèŒƒå›´å†…æµ®åŠ¨ï¼ˆç›®æ ‡1500ä¸‡Gasï¼Œæœ€å¤§3000ä¸‡Gasï¼‰ã€‚çŸ­æœŸæ‹¥å µæ—¶åŒºå—å¯ä»¥å˜å¤§ï¼Œä½†Base Feeä¼šè‡ªåŠ¨ä¸Šæ¶¨æ¥æŠ‘åˆ¶éœ€æ±‚ã€‚
>
> **å¯¹DAppå¼€å‘çš„å½±å“**ï¼šæˆ‘ä»¬ç°åœ¨å¯ä»¥æ›´å‡†ç¡®åœ°ä¼°ç®—è´¹ç”¨ï¼Œç”¨æˆ·ä½“éªŒæ›´å¥½ã€‚ä½†ä¹Ÿè¦æ³¨æ„maxFeePerGasè¦è®¾å¾—æ¯”å½“å‰baseFeeé«˜ä¸€äº›ï¼Œå¦åˆ™å¦‚æœbaseFeeä¸Šæ¶¨ï¼Œäº¤æ˜“ä¼špendingå¾ˆä¹…ã€‚

**ä¸ºä»€ä¹ˆè¿™ä¸ªå›ç­”å‡ºå½©ï¼Ÿ**
1. âœ… ä¸åªè¯´æŠ€æœ¯å˜åŒ–ï¼Œè¿˜è¯´äº†ç»æµå½±å“
2. âœ… æåˆ°ETHé€šç¼©çš„å®è§‚æ„ä¹‰
3. âœ… è§£é‡Šäº†åŒºå—å¼¹æ€§è¿™ä¸ªå¸¸è¢«å¿½ç•¥çš„ç‚¹
4. âœ… è”ç³»å®é™…DAppå¼€å‘ç»éªŒ

---

## 9. ã€åŒ–éª¨ç»µæŒã€‘

### å¡ç‰‡1ï¼šGasæ˜¯ä»€ä¹ˆï¼Ÿ ğŸ¯

**ä¸€å¥è¯ï¼š** Gasæ˜¯ä»¥å¤ªåŠçš„"ç‡ƒæ–™"ï¼Œæ¯ä¸ªæ“ä½œéƒ½æ¶ˆè€—ä¸€å®šé‡çš„Gasã€‚

**ä¸¾ä¾‹ï¼š**
- åŠ æ³•è¿ç®—ï¼š3 Gas
- ETHè½¬è´¦ï¼š21000 Gas
- å­˜å‚¨æ•°æ®ï¼š20000+ Gas

**åº”ç”¨ï¼š** ä½ å‘é€äº¤æ˜“æ—¶ï¼Œå¿…é¡»æä¾›è¶³å¤Ÿçš„Gasï¼Œå¦åˆ™äº¤æ˜“ä¼šå¤±è´¥ã€‚

---

### å¡ç‰‡2ï¼šGas Limit ğŸ“

**ä¸€å¥è¯ï¼š** Gas Limitæ˜¯ä½ æ„¿æ„ä¸ºäº¤æ˜“æ”¯ä»˜çš„æœ€å¤§Gasé‡ï¼Œç›¸å½“äº"é¢„ç®—ä¸Šé™"ã€‚

**ä¸¾ä¾‹ï¼š**
```javascript
{ gasLimit: 100000 }  // æœ€å¤šç”¨10ä¸‡Gas
// å®é™…åªç”¨äº†6ä¸‡ï¼Œå‰©ä¸‹4ä¸‡çš„é’±ä¼šé€€è¿˜
```

**åº”ç”¨ï¼š** å¤æ‚åˆçº¦è°ƒç”¨è¦è®¾é«˜ä¸€ç‚¹ï¼Œä½†è®¾å¤ªä½ä¼šå¯¼è‡´äº¤æ˜“å¤±è´¥ä¸”ä¸é€€Gasã€‚

---

### å¡ç‰‡3ï¼šGas Price ğŸ’°

**ä¸€å¥è¯ï¼š** Gas Priceæ˜¯æ¯å•ä½Gasçš„ä»·æ ¼ï¼Œå•ä½æ˜¯Gweiï¼ˆ1 Gwei = 0.000000001 ETHï¼‰ã€‚

**ä¸¾ä¾‹ï¼š**
```
äº¤æ˜“è´¹ = Gas Used Ã— Gas Price
= 21000 Ã— 20 Gwei
= 420000 Gwei
= 0.00042 ETH
```

**åº”ç”¨ï¼š** Gas Priceè¶Šé«˜ï¼Œäº¤æ˜“è¢«æ‰“åŒ…çš„ä¼˜å…ˆçº§è¶Šé«˜ã€‚

---

### å¡ç‰‡4ï¼šEIP-1559é©æ–° ğŸ”„

**ä¸€å¥è¯ï¼š** EIP-1559æŠŠGas Priceåˆ†æˆäº†Base Feeï¼ˆåè®®å®šï¼‰å’ŒPriority Feeï¼ˆç”¨æˆ·å®šï¼‰ã€‚

**ä¸¾ä¾‹ï¼š**
```javascript
{
  maxFeePerGas: 30 Gwei,      // æœ€å¤šä»˜30
  maxPriorityFeePerGas: 2 Gwei // å°è´¹2
}
// å¦‚æœBase Feeæ˜¯20ï¼Œå®é™…ä»˜ 20+2=22 Gwei
```

**åº”ç”¨ï¼š** Base Feeè¢«é”€æ¯ï¼ŒPriority Feeç»™éªŒè¯è€…ï¼Œè®©è´¹ç”¨æ›´å¯é¢„æµ‹ã€‚

---

### å¡ç‰‡5ï¼šä¸åŒæ“ä½œçš„Gasæ¶ˆè€— âš¡

**ä¸€å¥è¯ï¼š** å­˜å‚¨æ“ä½œæœ€è´µï¼Œè®¡ç®—æ“ä½œä¾¿å®œï¼Œè¯»å–é“¾ä¸‹å…è´¹ã€‚

**ä¸¾ä¾‹ï¼š**
| æ“ä½œ | Gasæ¶ˆè€— |
|------|--------|
| åŠ æ³• | 3 |
| è¯»å–å­˜å‚¨ | 200 |
| å†™å…¥æ–°å€¼ | 20000 |
| ETHè½¬è´¦ | 21000 |

**åº”ç”¨ï¼š** æ™ºèƒ½åˆçº¦ä¼˜åŒ–çš„æ ¸å¿ƒæ˜¯å‡å°‘å­˜å‚¨æ“ä½œã€‚

---

### å¡ç‰‡6ï¼šViewå‡½æ•°å…è´¹ ğŸ†“

**ä¸€å¥è¯ï¼š** `view`å’Œ`pure`å‡½æ•°åœ¨é“¾ä¸‹è°ƒç”¨æ—¶ä¸æ¶ˆè€—Gasã€‚

**ä¸¾ä¾‹ï¼š**
```javascript
// å…è´¹ï¼
const balance = await contract.balanceOf(address);

// è¦èŠ±é’±ï¼ˆå› ä¸ºå†™å…¥äº†é“¾ä¸ŠçŠ¶æ€ï¼‰
await contract.transfer(to, amount);
```

**åº”ç”¨ï¼š** DAppå°½é‡ç”¨viewå‡½æ•°è¯»å–æ•°æ®ï¼Œåªåœ¨å¿…è¦æ—¶å‘é€äº¤æ˜“ã€‚

---

### å¡ç‰‡7ï¼šGasä¼°ç®— ğŸ“Š

**ä¸€å¥è¯ï¼š** å‘é€äº¤æ˜“å‰ï¼Œå¯ä»¥ç”¨`estimateGas`é¢„ä¼°éœ€è¦å¤šå°‘Gasã€‚

**ä¸¾ä¾‹ï¼š**
```javascript
const gasLimit = await provider.estimateGas({
  to: contractAddress,
  data: encodedFunctionCall
});
// å»ºè®®è®¾ä¸ºä¼°ç®—å€¼çš„1.2å€ï¼Œç•™æœ‰ä½™é‡
```

**åº”ç”¨ï¼š** å¸®åŠ©ç”¨æˆ·äº†è§£äº¤æ˜“æˆæœ¬ï¼Œé¿å…Gasä¸è¶³å¯¼è‡´å¤±è´¥ã€‚

---

### å¡ç‰‡8ï¼šäº¤æ˜“å¤±è´¥ä¸Gas ğŸš«

**ä¸€å¥è¯ï¼š** äº¤æ˜“å¤±è´¥ï¼ˆrevertï¼‰æ—¶ï¼Œå·²æ¶ˆè€—çš„Gasä¸ä¼šé€€è¿˜ã€‚

**ä¸¾ä¾‹ï¼š**
```
Gas Limit: 100000
æ‰§è¡Œåˆ°50000æ—¶revert
ç»“æœ: 50000 Gasçš„è´¹ç”¨è¢«æ‰£é™¤ï¼Œäº¤æ˜“å¤±è´¥
```

**åº”ç”¨ï¼š** åˆçº¦è¦åœ¨å¼€å¤´åšå‚æ•°æ ¡éªŒï¼Œå°½æ—©å¤±è´¥å‡å°‘Gasæµªè´¹ã€‚

---

### å¡ç‰‡9ï¼šGasä¼˜åŒ–æŠ€å·§ ğŸ› ï¸

**ä¸€å¥è¯ï¼š** å­˜å‚¨æ‰“åŒ…ã€ç¼“å­˜å˜é‡ã€ç”¨calldataã€çŸ­è·¯æ±‚å€¼å¯ä»¥èŠ‚çœGasã€‚

**ä¸¾ä¾‹ï¼š**
```solidity
// ä¼˜åŒ–å‰ï¼šä¸¤ä¸ªslot
uint256 a; uint256 b;

// ä¼˜åŒ–åï¼šä¸€ä¸ªslot
uint128 a; uint128 b;
```

**åº”ç”¨ï¼š** Gasä¼˜åŒ–æ˜¯æ™ºèƒ½åˆçº¦å¼€å‘çš„æ ¸å¿ƒæŠ€èƒ½ï¼Œç›´æ¥å½±å“ç”¨æˆ·æˆæœ¬ã€‚

---

### å¡ç‰‡10ï¼šGasä¸ç½‘ç»œæ‹¥å µ ğŸŒ

**ä¸€å¥è¯ï¼š** ç½‘ç»œæ‹¥å µæ—¶Base Feeè‡ªåŠ¨ä¸Šæ¶¨ï¼Œé—²æ—¶ä¸‹é™ï¼Œå½¢æˆå¸‚åœºè°ƒèŠ‚ã€‚

**ä¸¾ä¾‹ï¼š**
- NFTçƒ­é—¨é“¸é€ æ—¶ï¼šBase Feeå¯èƒ½é£™åˆ°100+ Gwei
- æ·±å¤œä½å³°æœŸï¼šBase Feeå¯èƒ½åªæœ‰5-10 Gwei

**åº”ç”¨ï¼š** DAppå¯ä»¥å»ºè®®ç”¨æˆ·åœ¨ä½å³°æœŸæ“ä½œï¼Œæˆ–æä¾›Gasä»·æ ¼ç›‘æ§ã€‚

---

## 10. ã€ä¸€å¥è¯æ€»ç»“ã€‘

**Gasæ˜¯ä»¥å¤ªåŠçš„è®¡ç®—èµ„æºè®¡é‡å•ä½ï¼Œé€šè¿‡Gas Limitæ§åˆ¶å•ç¬”äº¤æ˜“ä¸Šé™ï¼Œé€šè¿‡Gas Priceå®ç°å¸‚åœºå®šä»·ï¼ŒEIP-1559è®©è´¹ç”¨æ›´å¯é¢„æµ‹å¹¶å¼•å…¥ETHé”€æ¯æœºåˆ¶ï¼Œç†è§£Gasæœºåˆ¶æ˜¯DAppå¼€å‘å’Œæ™ºèƒ½åˆçº¦ä¼˜åŒ–çš„åŸºç¡€ã€‚**

---

## ğŸ“š å­¦ä¹ æ£€æŸ¥æ¸…å•

- [ ] ç†è§£Gasã€Gas Limitã€Gas Priceçš„å…³ç³»
- [ ] çŸ¥é“EIP-1559çš„Base Feeå’ŒPriority Fee
- [ ] èƒ½ç”¨ethers.jsè·å–Gasä»·æ ¼å’Œä¼°ç®—Gas
- [ ] äº†è§£ä¸åŒæ“ä½œçš„Gasæ¶ˆè€—å·®å¼‚
- [ ] çŸ¥é“viewå‡½æ•°é“¾ä¸‹è°ƒç”¨å…è´¹
- [ ] æŒæ¡åŸºæœ¬çš„Gasä¼˜åŒ–æŠ€å·§

## ğŸ”— ä¸‹ä¸€æ­¥å­¦ä¹ 

- æ·±å…¥å­¦ä¹  [Solidity Gasä¼˜åŒ–](../04_Solidityæ™ºèƒ½åˆçº¦/Gasä¼˜åŒ–.md)
- äº†è§£ [äº¤æ˜“çŠ¶æ€å¤„ç†](../07_é’±åŒ…ä¸äº¤æ˜“/02_äº¤æ˜“çŠ¶æ€å¤„ç†.md)
- æ¢ç´¢ [Layer2çš„Gasæœºåˆ¶](../10_Layer2ä¸è·¨é“¾/Gaså¯¹æ¯”.md)

## ğŸ“– å‚è€ƒèµ„æº

- [Ethereum Yellow Paper - Gaså®šä¹‰](https://ethereum.github.io/yellowpaper/paper.pdf)
- [EIP-1559è§„èŒƒ](https://eips.ethereum.org/EIPS/eip-1559)
- [Ethers.jsæ–‡æ¡£ - Gas](https://docs.ethers.org/v6/)
