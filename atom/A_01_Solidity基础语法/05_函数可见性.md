# å‡½æ•°å¯è§æ€§ï¼ˆVisibilityï¼‰

## 1. ã€30å­—æ ¸å¿ƒã€‘

**å‡½æ•°å¯è§æ€§å®šä¹‰äº†è°èƒ½è°ƒç”¨å‡½æ•°ï¼špublicï¼ˆä»»ä½•äººï¼‰ã€externalï¼ˆä»…å¤–éƒ¨ï¼‰ã€internalï¼ˆæœ¬åˆçº¦+å­åˆçº¦ï¼‰ã€privateï¼ˆä»…æœ¬åˆçº¦ï¼‰ï¼Œæ˜¯æ™ºèƒ½åˆçº¦è®¿é—®æ§åˆ¶çš„åŸºç¡€ã€‚**

---

## 2. ã€ç¬¬ä¸€æ€§åŸç†ã€‘

### ä»€ä¹ˆæ˜¯ç¬¬ä¸€æ€§åŸç†ï¼Ÿ

**ç¬¬ä¸€æ€§åŸç†**ï¼šå›åˆ°äº‹ç‰©æœ€åŸºæœ¬çš„çœŸç†ï¼Œä»æºå¤´æ€è€ƒé—®é¢˜

### å‡½æ•°å¯è§æ€§çš„ç¬¬ä¸€æ€§åŸç† ğŸ¯

#### 1. æœ€åŸºç¡€çš„å®šä¹‰

**å¯è§æ€§ = è§„å®šè°æœ‰æƒè°ƒç”¨è¿™ä¸ªå‡½æ•°**

å››ç§å¯è§æ€§çº§åˆ«ï¼š
- **public**ï¼šä»»ä½•äººéƒ½èƒ½è°ƒç”¨ï¼ˆå¤–éƒ¨+å†…éƒ¨ï¼‰
- **external**ï¼šåªèƒ½ä»å¤–éƒ¨è°ƒç”¨
- **internal**ï¼šåªèƒ½ä»å†…éƒ¨è°ƒç”¨ï¼ˆæœ¬åˆçº¦+ç»§æ‰¿çš„å­åˆçº¦ï¼‰
- **private**ï¼šåªèƒ½ä»æœ¬åˆçº¦å†…éƒ¨è°ƒç”¨

ä»…æ­¤è€Œå·²ï¼æ²¡æœ‰æ›´åŸºç¡€çš„äº†ã€‚

#### 2. ä¸ºä»€ä¹ˆéœ€è¦å¯è§æ€§æ§åˆ¶ï¼Ÿ

**æ ¸å¿ƒé—®é¢˜ï¼šå¦‚ä½•ä¿æŠ¤åˆçº¦çš„æ•æ„ŸåŠŸèƒ½ï¼Œé˜²æ­¢æœªæˆæƒè®¿é—®ï¼Ÿ**

æ™ºèƒ½åˆçº¦éƒ¨ç½²åï¼Œä»£ç æ˜¯å…¬å¼€çš„ï¼Œä»»ä½•äººéƒ½å¯ä»¥å°è¯•è°ƒç”¨ä»»ä½•å‡½æ•°ã€‚å¦‚æœæ²¡æœ‰å¯è§æ€§æ§åˆ¶ï¼š
- ç®¡ç†å‘˜å‡½æ•°å¯èƒ½è¢«ä»»ä½•äººè°ƒç”¨
- å†…éƒ¨è¾…åŠ©å‡½æ•°æš´éœ²ç»™å¤–éƒ¨
- åˆçº¦ç»§æ‰¿æ—¶çš„æƒé™è¾¹ç•Œä¸æ¸…

#### 3. å¯è§æ€§çš„å››å±‚ä»·å€¼

##### ä»·å€¼1ï¼šå®‰å…¨æ€§ - é™åˆ¶æ•æ„ŸåŠŸèƒ½è®¿é—®

```solidity
contract Vault {
    address private owner;
    
    // âœ… åªæœ‰åˆçº¦å†…éƒ¨èƒ½è°ƒç”¨
    function _updateOwner(address newOwner) private {
        owner = newOwner;
    }
    
    // âŒ å¦‚æœæ˜¯publicï¼Œä»»ä½•äººéƒ½èƒ½æ”¹ownerï¼
    // function _updateOwner(address newOwner) public { ... }
}
```

##### ä»·å€¼2ï¼šå°è£…æ€§ - éšè—å®ç°ç»†èŠ‚

```solidity
contract Calculator {
    // å¯¹å¤–æš´éœ²çš„æ¥å£
    function calculate(uint256 a, uint256 b) public pure returns (uint256) {
        return _complexCalculation(a, b);
    }
    
    // å†…éƒ¨å®ç°ç»†èŠ‚ï¼Œä¸æš´éœ²
    function _complexCalculation(uint256 a, uint256 b) internal pure returns (uint256) {
        // å¤æ‚çš„è®¡ç®—é€»è¾‘...
        return a * b + (a + b);
    }
}
```

##### ä»·å€¼3ï¼šç»§æ‰¿æ§åˆ¶ - ç²¾ç¡®æ§åˆ¶å­åˆçº¦æƒé™

```solidity
contract Parent {
    // å­åˆçº¦å¯ä»¥è°ƒç”¨å’Œé‡å†™
    function protectedFunc() internal virtual returns (uint256) {
        return 100;
    }
    
    // å­åˆçº¦ä¸èƒ½è®¿é—®
    function secretFunc() private pure returns (uint256) {
        return 42;
    }
}

contract Child is Parent {
    function useProtected() public returns (uint256) {
        return protectedFunc();  // âœ… å¯ä»¥è®¿é—®internal
        // return secretFunc();  // âŒ ä¸èƒ½è®¿é—®private
    }
}
```

##### ä»·å€¼4ï¼šGasä¼˜åŒ– - externalæ¯”publicæ›´çœGas

```solidity
contract GasDemo {
    // externalï¼šå‚æ•°å¯ä»¥ç”¨calldataï¼Œæ›´çœGas
    function efficientFunc(uint256[] calldata data) external pure returns (uint256) {
        return data.length;
    }
    
    // publicï¼šå‚æ•°å¿…é¡»ç”¨memoryï¼Œç¨å¾®è´µä¸€ç‚¹
    function lessEfficientFunc(uint256[] memory data) public pure returns (uint256) {
        return data.length;
    }
}
```

#### 4. ä»ç¬¬ä¸€æ€§åŸç†æ¨å¯¼å¯è§æ€§è®¾è®¡

**æ¨ç†é“¾ï¼š**

```
1. å‰æï¼šæ™ºèƒ½åˆçº¦ä»£ç å…¬å¼€ï¼Œä»»ä½•äººéƒ½èƒ½å°è¯•è°ƒç”¨
   â†“
2. æ¨å¯¼ï¼šéœ€è¦æœºåˆ¶é™åˆ¶è°èƒ½è°ƒç”¨å“ªäº›å‡½æ•°
   â†“
3. æ¨å¯¼ï¼šæœ€å®½æ¾ = ä»»ä½•äººéƒ½èƒ½è°ƒç”¨ â†’ public
   â†“
4. æ¨å¯¼ï¼šåªå¯¹å¤–éƒ¨ç”¨æˆ·å¼€æ”¾ = external
   â†“
5. æ¨å¯¼ï¼šåˆçº¦å®¶æ—å†…éƒ¨å…±äº« = internalï¼ˆæ”¯æŒç»§æ‰¿ï¼‰
   â†“
6. æ¨å¯¼ï¼šä»…æœ¬åˆçº¦ç§æœ‰ = private
   â†“
7. æ¨å¯¼ï¼šexternalæ¯”publicçœGasï¼ˆå‚æ•°å¯ç”¨calldataï¼‰
   â†“
8. æœ€ç»ˆï¼šå››çº§å¯è§æ€§ä½“ç³»
```

#### 5. ä¸€å¥è¯æ€»ç»“ç¬¬ä¸€æ€§åŸç†

**å¯è§æ€§æ˜¯æ™ºèƒ½åˆçº¦çš„è®¿é—®æ§åˆ¶æœºåˆ¶ï¼Œé€šè¿‡public/external/internal/privateå››ä¸ªçº§åˆ«ï¼Œæ§åˆ¶å‡½æ•°çš„è°ƒç”¨èŒƒå›´ï¼Œæ˜¯å®‰å…¨æ€§å’ŒGasä¼˜åŒ–çš„åŸºç¡€ã€‚**

---

## 3. ã€3ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‘

### æ ¸å¿ƒæ¦‚å¿µ1ï¼šå››ç§å¯è§æ€§çº§åˆ« ğŸ”

**ä¸€å¥è¯å®šä¹‰ï¼š** publicä»»ä½•äººå¯è°ƒç”¨ï¼Œexternalä»…å¤–éƒ¨è°ƒç”¨ï¼Œinternalæœ¬åˆçº¦å’Œå­åˆçº¦ï¼Œprivateä»…æœ¬åˆçº¦ã€‚

#### å¯è§æ€§å¯¹æ¯”è¡¨ï¼š

| å¯è§æ€§ | å¤–éƒ¨è°ƒç”¨ | å†…éƒ¨è°ƒç”¨ | å­åˆçº¦ | Gasä¼˜åŒ– |
|-------|---------|---------|--------|---------|
| public | âœ… | âœ… | âœ… | ä¸­ç­‰ |
| external | âœ… | âŒ | âŒ | æœ€ä¼˜ |
| internal | âŒ | âœ… | âœ… | N/A |
| private | âŒ | âœ… | âŒ | N/A |

#### å®Œæ•´ä»£ç ç¤ºä¾‹ï¼š

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract VisibilityDemo {
    uint256 private secretValue = 42;
    
    // ===== PUBLIC =====
    // ä»»ä½•äººéƒ½èƒ½è°ƒç”¨ï¼šå¤–éƒ¨EOAã€å…¶ä»–åˆçº¦ã€æœ¬åˆçº¦å†…éƒ¨ã€å­åˆçº¦
    function publicFunc() public pure returns (string memory) {
        return "I'm public - anyone can call me!";
    }
    
    // ===== EXTERNAL =====
    // åªèƒ½ä»å¤–éƒ¨è°ƒç”¨ï¼šEOAæˆ–å…¶ä»–åˆçº¦
    // ä¸èƒ½åœ¨æœ¬åˆçº¦å†…éƒ¨ç›´æ¥è°ƒç”¨ï¼ˆé™¤éç”¨this.externalFunc()ï¼‰
    function externalFunc() external pure returns (string memory) {
        return "I'm external - only external calls!";
    }
    
    // ===== INTERNAL =====
    // åªèƒ½ä»æœ¬åˆçº¦æˆ–å­åˆçº¦å†…éƒ¨è°ƒç”¨
    function internalFunc() internal pure returns (string memory) {
        return "I'm internal - contract family only!";
    }
    
    // ===== PRIVATE =====
    // åªèƒ½ä»æœ¬åˆçº¦å†…éƒ¨è°ƒç”¨ï¼Œå­åˆçº¦éƒ½ä¸è¡Œ
    function privateFunc() private pure returns (string memory) {
        return "I'm private - this contract only!";
    }
    
    // ===== æ¼”ç¤ºå†…éƒ¨è°ƒç”¨ =====
    function demonstrateCalls() public view returns (
        string memory pub,
        string memory ext,
        string memory inter,
        string memory priv
    ) {
        pub = publicFunc();           // âœ… å¯ä»¥è°ƒç”¨public
        ext = this.externalFunc();    // âœ… é€šè¿‡thiså¯ä»¥è°ƒç”¨external
        inter = internalFunc();       // âœ… å¯ä»¥è°ƒç”¨internal
        priv = privateFunc();         // âœ… å¯ä»¥è°ƒç”¨private
    }
}

contract ChildContract is VisibilityDemo {
    function childCalls() public view returns (
        string memory pub,
        string memory inter
    ) {
        pub = publicFunc();           // âœ… ç»§æ‰¿äº†public
        inter = internalFunc();       // âœ… ç»§æ‰¿äº†internal
        // privateFunc();             // âŒ ä¸èƒ½è®¿é—®private
    }
}
```

---

### æ ¸å¿ƒæ¦‚å¿µ2ï¼šexternal vs public çš„åŒºåˆ« ğŸ†š

**ä¸€å¥è¯å®šä¹‰ï¼š** externalåªèƒ½ä»å¤–éƒ¨è°ƒç”¨ä¸”å‚æ•°å¯ç”¨calldataï¼Œpublicå¯ä»¥å†…å¤–è°ƒç”¨ä½†å‚æ•°å¿…é¡»ç”¨memoryã€‚

#### å…³é”®åŒºåˆ«ï¼š

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract ExternalVsPublic {
    
    // ===== EXTERNAL =====
    // ä¼˜ç‚¹ï¼šå‚æ•°å¯ä»¥ç”¨calldataï¼Œæ›´çœGas
    // ç¼ºç‚¹ï¼šä¸èƒ½åœ¨åˆçº¦å†…éƒ¨ç›´æ¥è°ƒç”¨
    function externalWithCalldata(uint256[] calldata data) external pure returns (uint256) {
        uint256 sum = 0;
        for (uint i = 0; i < data.length; i++) {
            sum += data[i];
        }
        return sum;
    }
    
    // ===== PUBLIC =====
    // ä¼˜ç‚¹ï¼šå¯ä»¥åœ¨åˆçº¦å†…éƒ¨è°ƒç”¨
    // ç¼ºç‚¹ï¼šå‚æ•°å¿…é¡»ç”¨memoryï¼ˆå› ä¸ºå†…éƒ¨è°ƒç”¨æ—¶å¯èƒ½æ²¡æœ‰calldataï¼‰
    function publicWithMemory(uint256[] memory data) public pure returns (uint256) {
        uint256 sum = 0;
        for (uint i = 0; i < data.length; i++) {
            sum += data[i];
        }
        return sum;
    }
    
    // ===== å†…éƒ¨è°ƒç”¨æ¼”ç¤º =====
    function internalDemo() public pure returns (uint256) {
        uint256[] memory arr = new uint256[](3);
        arr[0] = 1;
        arr[1] = 2;
        arr[2] = 3;
        
        // âŒ ä¸èƒ½ç›´æ¥è°ƒç”¨externalå‡½æ•°
        // return externalWithCalldata(arr);  // ç¼–è¯‘é”™è¯¯
        
        // âœ… å¯ä»¥è°ƒç”¨publicå‡½æ•°
        return publicWithMemory(arr);
    }
    
    // ===== é€šè¿‡thisè°ƒç”¨externalï¼ˆä¸æ¨èï¼Œæµªè´¹Gasï¼‰=====
    function callExternalViaThis() external view returns (uint256) {
        uint256[] memory arr = new uint256[](3);
        arr[0] = 1;
        arr[1] = 2;
        arr[2] = 3;
        
        // å¯ä»¥é€šè¿‡thisè°ƒç”¨ï¼Œä½†ä¼šäº§ç”Ÿé¢å¤–çš„å¤–éƒ¨è°ƒç”¨å¼€é”€
        return this.externalWithCalldata(arr);
    }
}
```

**é€‰æ‹©å»ºè®®ï¼š**

```
é€‰æ‹©å†³ç­–æ ‘ï¼š

å‡½æ•°æ˜¯å¦éœ€è¦è¢«åˆçº¦å†…éƒ¨è°ƒç”¨ï¼Ÿ
â”œâ”€â”€ æ˜¯ â†’ ä½¿ç”¨ public
â”‚         â””â”€â”€ å‚æ•°å¿…é¡»ç”¨ memory
â””â”€â”€ å¦ â†’ ä½¿ç”¨ externalï¼ˆæ›´çœGasï¼‰
          â””â”€â”€ å‚æ•°å¯ä»¥ç”¨ calldata
```

---

### æ ¸å¿ƒæ¦‚å¿µ3ï¼šç»§æ‰¿ä¸å¯è§æ€§ ğŸ§¬

**ä¸€å¥è¯å®šä¹‰ï¼š** publicå’Œinternalå‡½æ•°å¯ä»¥è¢«å­åˆçº¦ç»§æ‰¿å’Œé‡å†™ï¼Œprivateå‡½æ•°å¯¹å­åˆçº¦å®Œå…¨ä¸å¯è§ã€‚

#### ç»§æ‰¿è§„åˆ™è¯¦è§£ï¼š

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract Parent {
    // ===== PUBLICï¼šå­åˆçº¦ç»§æ‰¿ï¼Œå¯é‡å†™ =====
    function publicFunc() public virtual pure returns (string memory) {
        return "Parent public";
    }
    
    // ===== EXTERNALï¼šå­åˆçº¦ç»§æ‰¿ï¼Œå¯é‡å†™ =====
    function externalFunc() external virtual pure returns (string memory) {
        return "Parent external";
    }
    
    // ===== INTERNALï¼šå­åˆçº¦ç»§æ‰¿ï¼Œå¯é‡å†™ï¼Œå¯åœ¨å­åˆçº¦å†…è°ƒç”¨ =====
    function internalFunc() internal virtual pure returns (string memory) {
        return "Parent internal";
    }
    
    // ===== PRIVATEï¼šå­åˆçº¦å®Œå…¨ä¸å¯è§ =====
    function privateFunc() private pure returns (string memory) {
        return "Parent private";
    }
    
    // çˆ¶åˆçº¦å¯ä»¥è°ƒç”¨è‡ªå·±çš„private
    function parentCallsPrivate() public pure returns (string memory) {
        return privateFunc();
    }
}

contract Child is Parent {
    // ===== é‡å†™publicå‡½æ•° =====
    function publicFunc() public pure virtual override returns (string memory) {
        return "Child public (overridden)";
    }
    
    // ===== é‡å†™externalå‡½æ•° =====
    function externalFunc() external pure override returns (string memory) {
        return "Child external (overridden)";
    }
    
    // ===== é‡å†™internalå‡½æ•° =====
    function internalFunc() internal pure override returns (string memory) {
        return "Child internal (overridden)";
    }
    
    // ===== å­åˆçº¦ä½¿ç”¨ç»§æ‰¿çš„å‡½æ•° =====
    function childDemo() public pure returns (
        string memory pub,
        string memory inter
    ) {
        pub = publicFunc();      // âœ… è°ƒç”¨è‡ªå·±é‡å†™çš„ç‰ˆæœ¬
        inter = internalFunc();  // âœ… è°ƒç”¨è‡ªå·±é‡å†™çš„ç‰ˆæœ¬
        // privateFunc();        // âŒ å®Œå…¨çœ‹ä¸åˆ°çˆ¶åˆçº¦çš„private
    }
    
    // ===== è°ƒç”¨çˆ¶åˆçº¦ç‰ˆæœ¬ =====
    function callParentVersions() public pure returns (string memory) {
        return super.internalFunc();  // è°ƒç”¨Parent.internalFunc()
        // æ³¨æ„ï¼šè¿™é‡Œä¼šè¿”å›"Parent internal"ï¼Œå› ä¸ºç”¨äº†super
        // ä½†ç”±äºæˆ‘ä»¬é‡å†™äº†ï¼Œå®é™…ä¸Šsuperè°ƒç”¨çš„æ˜¯Childçš„ï¼Œè¿™é‡Œä¼šè¿”å›Childçš„
        // è¦çœŸæ­£è°ƒç”¨Parentçš„ï¼Œéœ€è¦Parent.internalFunc()
    }
}

contract GrandChild is Child {
    // å­™å­åˆçº¦å¯ä»¥ç»§ç»­é‡å†™
    function publicFunc() public pure override returns (string memory) {
        return "GrandChild public";
    }
    
    // å¯ä»¥è°ƒç”¨çˆ¶é“¾ä¸­çš„internalå‡½æ•°
    function grandChildDemo() public pure returns (string memory) {
        return internalFunc();  // è°ƒç”¨Childé‡å†™çš„ç‰ˆæœ¬
    }
}
```

**ç»§æ‰¿å¯è§æ€§æ€»ç»“ï¼š**

| å¯è§æ€§ | æ˜¯å¦è¢«ç»§æ‰¿ | å­åˆçº¦å¯é‡å†™ | å­åˆçº¦å¯è°ƒç”¨ |
|-------|----------|-------------|-------------|
| public | âœ… | âœ…ï¼ˆéœ€virtual/overrideï¼‰| âœ… |
| external | âœ… | âœ…ï¼ˆéœ€virtual/overrideï¼‰| ä»…é€šè¿‡this |
| internal | âœ… | âœ…ï¼ˆéœ€virtual/overrideï¼‰| âœ… |
| private | âŒ | âŒ | âŒ |

---

## 4. ã€æœ€å°å¯ç”¨ã€‘

æŒæ¡ä»¥ä¸‹å†…å®¹ï¼Œå°±èƒ½æ­£ç¡®ä½¿ç”¨å‡½æ•°å¯è§æ€§ï¼š

### 4.1 æœ€å¸¸ç”¨çš„æ¨¡å¼

```solidity
contract CommonPatterns {
    address public owner;
    
    constructor() {
        owner = msg.sender;
    }
    
    // æ¨¡å¼1ï¼šå¯¹å¤–æ¥å£ç”¨externalï¼ˆæœ€çœGasï¼‰
    function deposit() external payable {
        // å¤„ç†å­˜æ¬¾
    }
    
    // æ¨¡å¼2ï¼šéœ€è¦å†…éƒ¨è°ƒç”¨çš„ç”¨public
    function getBalance() public view returns (uint256) {
        return address(this).balance;
    }
    
    // æ¨¡å¼3ï¼šè¾…åŠ©å‡½æ•°ç”¨internalï¼ˆå­åˆçº¦å¯èƒ½éœ€è¦ï¼‰
    function _validateInput(uint256 amount) internal pure returns (bool) {
        return amount > 0;
    }
    
    // æ¨¡å¼4ï¼šæ•æ„Ÿé€»è¾‘ç”¨privateï¼ˆä¸æƒ³è¢«ç»§æ‰¿ï¼‰
    function _updateInternalState() private {
        // åªæœ‰æœ¬åˆçº¦èƒ½è°ƒç”¨
    }
}
```

### 4.2 å¿«é€Ÿé€‰æ‹©æŒ‡å—

```solidity
// é—®è‡ªå·±è¿™ä¸ªé—®é¢˜ï¼šè°éœ€è¦è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Ÿ

// 1. åªæœ‰å¤–éƒ¨ç”¨æˆ·/åˆçº¦è°ƒç”¨ â†’ external
function withdraw(uint256 amount) external { }

// 2. å¤–éƒ¨+å†…éƒ¨éƒ½éœ€è¦è°ƒç”¨ â†’ public
function balanceOf(address account) public view returns (uint256) { }

// 3. åªæœ‰æœ¬åˆçº¦+å­åˆçº¦å†…éƒ¨ä½¿ç”¨ â†’ internal
function _mint(address to, uint256 amount) internal { }

// 4. åªæœ‰æœ¬åˆçº¦ä½¿ç”¨ï¼Œå­åˆçº¦ä¹Ÿä¸èƒ½ç”¨ â†’ private
function _checkOwner() private view { }
```

### 4.3 çŠ¶æ€å˜é‡çš„å¯è§æ€§

```solidity
contract StateVisibility {
    // publicï¼šè‡ªåŠ¨ç”Ÿæˆgetterå‡½æ•°
    uint256 public totalSupply;
    // ç­‰åŒäºï¼šfunction totalSupply() external view returns (uint256) { return totalSupply; }
    
    // internalï¼šæœ¬åˆçº¦+å­åˆçº¦å¯è®¿é—®ï¼ˆé»˜è®¤ï¼‰
    uint256 internal reservedAmount;
    
    // privateï¼šä»…æœ¬åˆçº¦å¯è®¿é—®
    uint256 private secretKey;
    
    // æ³¨æ„ï¼šprivateä¸æ„å‘³ç€æ•°æ®æ˜¯éšè—çš„ï¼
    // ä»»ä½•äººéƒ½å¯ä»¥é€šè¿‡è¯»å–Storage slotè·å–privateå˜é‡çš„å€¼
    // privateåªæ˜¯é™åˆ¶äº†åˆçº¦çº§åˆ«çš„è®¿é—®
}
```

### 4.4 å¸¸è§é”™è¯¯é¿å…

```solidity
contract CommonMistakes {
    // âŒ é”™è¯¯ï¼šæ•æ„Ÿå‡½æ•°ç”¨public
    // function setOwner(address newOwner) public {
    //     owner = newOwner;  // ä»»ä½•äººéƒ½èƒ½è°ƒï¼
    // }
    
    // âœ… æ­£ç¡®ï¼šæ•æ„Ÿå‡½æ•°ç”¨privateæˆ–åŠ modifier
    address private owner;
    
    modifier onlyOwner() {
        require(msg.sender == owner, "Not owner");
        _;
    }
    
    function setOwner(address newOwner) external onlyOwner {
        owner = newOwner;
    }
    
    // âŒ é”™è¯¯ï¼šexternalå‡½æ•°ç”¨äºå†…éƒ¨é€’å½’
    // function factorial(uint n) external pure returns (uint) {
    //     if (n <= 1) return 1;
    //     return n * factorial(n - 1);  // ç¼–è¯‘é”™è¯¯
    // }
    
    // âœ… æ­£ç¡®ï¼šéœ€è¦é€’å½’çš„ç”¨publicæˆ–internal
    function factorial(uint n) public pure returns (uint) {
        if (n <= 1) return 1;
        return n * factorial(n - 1);
    }
}
```

---

**è¿™äº›çŸ¥è¯†è¶³ä»¥ï¼š**
- âœ… æ­£ç¡®é€‰æ‹©å‡½æ•°çš„å¯è§æ€§çº§åˆ«
- âœ… ç†è§£ç»§æ‰¿æ—¶çš„å¯è§æ€§è§„åˆ™
- âœ… é¿å…å¸¸è§çš„å®‰å…¨é”™è¯¯
- âœ… è¿›è¡ŒåŸºæœ¬çš„Gasä¼˜åŒ–

---

## 5. ã€1ä¸ªç±»æ¯”ã€‘

### ç±»æ¯”1ï¼šå¯è§æ€§ = å…¬å¸é—¨ç¦ç³»ç»Ÿ ğŸ¢

#### ç”Ÿæ´»åœºæ™¯ç±»æ¯”ï¼šåŠå…¬å¤§æ¥¼çš„è®¿é—®æƒé™

æƒ³è±¡ä¸€ä¸ªå…¬å¸åŠå…¬å¤§æ¥¼ï¼š

**é—¨ç¦çº§åˆ«ï¼š**
- **publicï¼ˆå¤§å ‚ï¼‰**ï¼šä»»ä½•äººéƒ½èƒ½è¿›å…¥ï¼ŒåŒ…æ‹¬è®¿å®¢ã€å‘˜å·¥ã€æ¸…æ´å·¥
- **externalï¼ˆä¼šè®®å®¤ï¼‰**ï¼šåªæœ‰å¤–éƒ¨è®¿å®¢èƒ½ç”¨ï¼ˆå‘˜å·¥æœ‰è‡ªå·±çš„å·¥ä½ï¼‰
- **internalï¼ˆåŠå…¬åŒºï¼‰**ï¼šåªæœ‰å…¬å¸å‘˜å·¥èƒ½è¿›å…¥ï¼ˆåŒ…æ‹¬å­å…¬å¸å‘˜å·¥ï¼‰
- **privateï¼ˆCEOåŠå…¬å®¤ï¼‰**ï¼šåªæœ‰CEOæœ¬äººèƒ½è¿›å…¥

**å¯¹åº”å…³ç³»ï¼š**

| åŒºåŸŸ | å¯è§æ€§ | è°èƒ½è¿›å…¥ |
|-----|-------|---------|
| å¤§å ‚ | public | æ‰€æœ‰äºº |
| è®¿å®¢ä¼šè®®å®¤ | external | ä»…å¤–éƒ¨è®¿å®¢ |
| åŠå…¬åŒº | internal | å‘˜å·¥+å­å…¬å¸å‘˜å·¥ |
| CEOåŠå…¬å®¤ | private | ä»…CEO |

**ä¸¾ä¾‹ï¼š**

```
å…¬å¸ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¤§æ¥¼ï¼ˆåˆçº¦ï¼‰                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ å¤§å ‚ï¼ˆpublicï¼‰- ä»»ä½•äºº              â”‚ â”‚
â”‚  â”‚   â””â”€ æ¥å¾…å°ã€å’–å•¡æœº                 â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ è®¿å®¢ä¼šè®®å®¤ï¼ˆexternalï¼‰- ä»…å¤–éƒ¨è®¿å®¢  â”‚ â”‚
â”‚  â”‚   â””â”€ ä¾›å®¢æˆ·ä½¿ç”¨                     â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ åŠå…¬åŒºï¼ˆinternalï¼‰- å‘˜å·¥+å­å…¬å¸     â”‚ â”‚
â”‚  â”‚   â””â”€ å·¥ä½ã€å†…éƒ¨ä¼šè®®å®¤               â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ CEOåŠå…¬å®¤ï¼ˆprivateï¼‰- ä»…CEO        â”‚ â”‚
â”‚  â”‚   â””â”€ æœºå¯†æ–‡ä»¶                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```solidity
contract Company {
    // å¤§å ‚ - æ‰€æœ‰äººå¯è®¿é—®
    function lobby() public pure returns (string memory) {
        return "Welcome to lobby!";
    }
    
    // è®¿å®¢ä¼šè®®å®¤ - åªå¯¹å¤–å¼€æ”¾
    function meetingRoom() external pure returns (string memory) {
        return "Meeting room for external visitors";
    }
    
    // åŠå…¬åŒº - å‘˜å·¥ä¸“ç”¨
    function office() internal pure returns (string memory) {
        return "Employee workspace";
    }
    
    // CEOåŠå…¬å®¤ - ç§å¯†
    function ceoOffice() private pure returns (string memory) {
        return "CEO's private space";
    }
}

// å­å…¬å¸ï¼ˆç»§æ‰¿ï¼‰
contract Subsidiary is Company {
    function accessTest() public pure returns (string memory, string memory) {
        // å¯ä»¥è¿›å¤§å ‚
        string memory l = lobby();
        // å¯ä»¥è¿›åŠå…¬åŒºï¼ˆinternalï¼‰
        string memory o = office();
        // ä¸èƒ½è¿›CEOåŠå…¬å®¤ï¼ˆprivateï¼‰
        // ceoOffice();  // âŒ
        return (l, o);
    }
}
```

---

#### å‰ç«¯é¢†åŸŸç±»æ¯”ï¼šESæ¨¡å—çš„å¯¼å‡º

å¦‚æœä½ æ˜¯å‰ç«¯å·¥ç¨‹å¸ˆï¼Œå¯è§æ€§å°±åƒJavaScriptæ¨¡å—çš„å¯¼å‡ºï¼š

```javascript
// JavaScriptæ¨¡å—ï¼ˆutils.jsï¼‰

// public: å¯¼å‡ºçš„å‡½æ•°ï¼Œä»»ä½•äººéƒ½èƒ½import
export function publicHelper() {
    return "I'm exported - anyone can import me";
}

// external: æ²¡æœ‰ç²¾ç¡®å¯¹åº”ï¼Œä½†å¯ä»¥æƒ³è±¡æˆåªç»™å¤–éƒ¨APIç”¨
// ç±»ä¼¼åªåœ¨index.jsä¸­re-exportçš„å‡½æ•°

// internal: æœªå¯¼å‡ºä½†åœ¨åŒä¸€åŒ…/ç›®å½•ä¸‹å¯ç”¨
// JavaScriptæ²¡æœ‰è¿™ä¸ªæ¦‚å¿µï¼Œä½†åœ¨TypeScriptçš„internalæ¨¡å—ä¸­æœ‰ç±»ä¼¼æ¦‚å¿µ
function internalHelper() {
    return "Only for this package";
}

// private: æ¨¡å—å†…ç§æœ‰å‡½æ•°
function _privateHelper() {
    return "Only in this file";
}

// æ¨¡å—å†…å¯ä»¥ä½¿ç”¨æ‰€æœ‰å‡½æ•°
export function mainFunction() {
    publicHelper();    // âœ…
    internalHelper();  // âœ…
    _privateHelper();  // âœ…
}
```

**TypeScriptçš„ç±»æ¯”æ›´ç²¾ç¡®ï¼š**

```typescript
// TypeScript Class
class Contract {
    // public: é»˜è®¤ï¼Œä»»ä½•äººéƒ½èƒ½è®¿é—®
    public publicMethod() { }
    
    // æ²¡æœ‰externalå¯¹åº”
    
    // protected â‰ˆ internal: å­ç±»å¯è®¿é—®
    protected internalMethod() { }
    
    // private: ä»…æœ¬ç±»å¯è®¿é—®
    private privateMethod() { }
}

class ChildContract extends Contract {
    demo() {
        this.publicMethod();     // âœ…
        this.internalMethod();   // âœ… (protected)
        // this.privateMethod(); // âŒ
    }
}
```

**å¯¹åº”å…³ç³»ï¼š**

| Solidity | TypeScript | JavaScript |
|----------|-----------|------------|
| public | public | export |
| external | (æ— ) | (æ— ) |
| internal | protected | æœªå¯¼å‡º+åŒåŒ… |
| private | private | æ¨¡å—å†…ç§æœ‰å‡½æ•° |

---

### ç±»æ¯”2ï¼šexternal vs public = ä¸“çº¿ç”µè¯ vs æ™®é€šç”µè¯ ğŸ“

#### ç”Ÿæ´»åœºæ™¯ç±»æ¯”

**externalå‡½æ•° = ä¸“çº¿ç”µè¯ï¼š**
- åªæ¥å¤–éƒ¨æ¥ç”µ
- æ¥ç”µæ˜¾ç¤ºæ¸…æ™°ï¼ˆcalldataï¼‰
- ä¸èƒ½å†…éƒ¨æ‹¨æ‰“ï¼ˆä¸èƒ½ç”¨åˆ†æœºå·æ‰“ï¼‰

**publicå‡½æ•° = æ™®é€šç”µè¯ï¼š**
- å¤–éƒ¨å’Œå†…éƒ¨éƒ½èƒ½æ‰“
- éœ€è¦è½¬æ¥å¤„ç†ï¼ˆå¤åˆ¶åˆ°memoryï¼‰
- åŠŸèƒ½æ›´å…¨é¢ä½†ç¨æ…¢

```solidity
contract PhoneSystem {
    // ä¸“çº¿ç”µè¯ - åªæ¥å¤–çº¿
    function hotline(uint256[] calldata data) external pure returns (uint256) {
        // ç›´æ¥å¤„ç†å¤–éƒ¨æ•°æ®ï¼ˆcalldataï¼‰
        return data.length;
    }
    
    // æ™®é€šç”µè¯ - å†…å¤–éƒ½æ¥
    function generalLine(uint256[] memory data) public pure returns (uint256) {
        // æ•°æ®éœ€è¦åœ¨memoryä¸­
        return data.length;
    }
    
    // å†…éƒ¨è½¬æ¥
    function internalCall() public pure returns (uint256) {
        uint256[] memory arr = new uint256[](3);
        
        // âŒ ä¸èƒ½æ‰“ä¸“çº¿
        // return hotline(arr);
        
        // âœ… å¯ä»¥æ‰“æ™®é€šç”µè¯
        return generalLine(arr);
    }
}
```

---

### ç±»æ¯”æ€»ç»“è¡¨

| å¯è§æ€§ | ç”Ÿæ´»åœºæ™¯ç±»æ¯” | å‰ç«¯é¢†åŸŸç±»æ¯” | æ ¸å¿ƒç‰¹ç‚¹ |
|-------|-------------|-------------|---------|
| public | å¤§æ¥¼å¤§å ‚ | export function | ä»»ä½•äººéƒ½èƒ½è®¿é—® |
| external | è®¿å®¢ä¼šè®®å®¤ | ä¸“ç”¨APIç«¯ç‚¹ | ä»…å¤–éƒ¨è°ƒç”¨ï¼Œå‚æ•°å¯ç”¨calldata |
| internal | å‘˜å·¥åŠå…¬åŒº | protectedæ–¹æ³• | æœ¬åˆçº¦+å­åˆçº¦ |
| private | CEOåŠå…¬å®¤ | privateæ–¹æ³• | ä»…æœ¬åˆçº¦ |

---

## 6. ã€åç›´è§‰ç‚¹ã€‘

### è¯¯åŒº1ï¼šprivateå˜é‡çš„æ•°æ®æ˜¯éšè—çš„ âŒ

**ä¸ºä»€ä¹ˆé”™ï¼Ÿ**

`private`åªæ˜¯é™åˆ¶äº†**åˆçº¦çº§åˆ«**çš„è®¿é—®ï¼Œä½†åŒºå—é“¾ä¸Šçš„æ‰€æœ‰æ•°æ®éƒ½æ˜¯**å…¬å¼€çš„**ã€‚ä»»ä½•äººéƒ½å¯ä»¥é€šè¿‡è¯»å–Storageç›´æ¥è·å–privateå˜é‡çš„å€¼ã€‚

```solidity
contract SecretVault {
    // âŒ é”™è¯¯è®¤çŸ¥ï¼šè¿™ä¸ªå¯†ç æ˜¯å®‰å…¨éšè—çš„
    uint256 private secretPassword = 12345;
    
    // å®é™…ä¸Šï¼šä»»ä½•äººéƒ½å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è¯»å–
    // 1. ä½¿ç”¨ethers.js: provider.getStorageAt(contractAddress, 0)
    // 2. ä½¿ç”¨Etherscançš„"Read Contract"åŠŸèƒ½ï¼ˆå¦‚æœçŸ¥é“slotï¼‰
}
```

```javascript
// æ”»å‡»è€…å¯ä»¥è¿™æ ·è¯»å–"private"å˜é‡
const ethers = require('ethers');
const provider = new ethers.JsonRpcProvider('https://eth.llamarpc.com');

// è¯»å–slot 0ï¼ˆç¬¬ä¸€ä¸ªçŠ¶æ€å˜é‡ï¼‰
const secretValue = await provider.getStorageAt(contractAddress, 0);
console.log(parseInt(secretValue, 16));  // è¾“å‡º: 12345
```

**ä¸ºä»€ä¹ˆäººä»¬å®¹æ˜“è¿™æ ·é”™ï¼Ÿ**

åœ¨ä¼ ç»Ÿç¼–ç¨‹è¯­è¨€ä¸­ï¼Œprivateæ„å‘³ç€æ•°æ®å¯¹å¤–ä¸å¯è§ã€‚ä½†åŒºå—é“¾çš„é€æ˜æ€§å†³å®šäº†æ‰€æœ‰å­˜å‚¨æ•°æ®éƒ½æ˜¯å…¬å¼€çš„ã€‚

**æ­£ç¡®ç†è§£ï¼š**

```solidity
contract CorrectUnderstanding {
    // privateé™åˆ¶çš„æ˜¯"è°èƒ½åœ¨åˆçº¦ä»£ç ä¸­è®¿é—®"
    // ä¸æ˜¯"è°èƒ½çœ‹åˆ°è¿™ä¸ªæ•°æ®"
    
    uint256 private counter;  // å…¶ä»–åˆçº¦ä¸èƒ½è¯»ï¼Œä½†é“¾ä¸Šæ•°æ®å¯è§
    
    // å¦‚æœçœŸçš„éœ€è¦éšè—æ•°æ®ï¼Œä½¿ç”¨å¯†ç å­¦æ–¹æ¡ˆ
    // ä¾‹å¦‚ï¼šå­˜å‚¨å“ˆå¸Œè€Œä¸æ˜¯åŸæ–‡
    bytes32 private hashedSecret;
    
    function setSecret(string memory secret) external {
        hashedSecret = keccak256(bytes(secret));
    }
    
    function verifySecret(string memory guess) external view returns (bool) {
        return keccak256(bytes(guess)) == hashedSecret;
    }
}
```

---

### è¯¯åŒº2ï¼šexternalå‡½æ•°ä¸èƒ½è¢«åˆçº¦è‡ªå·±è°ƒç”¨ âŒ

**ä¸ºä»€ä¹ˆé”™ï¼Ÿ**

Externalå‡½æ•°**ä¸èƒ½ç›´æ¥**è¢«å†…éƒ¨è°ƒç”¨ï¼Œä½†å¯ä»¥é€šè¿‡`this.functionName()`çš„æ–¹å¼è°ƒç”¨ã€‚åªæ˜¯è¿™æ ·åšä¼šäº§ç”Ÿé¢å¤–çš„Gaså¼€é”€ï¼ˆå› ä¸ºæ˜¯çœŸæ­£çš„å¤–éƒ¨è°ƒç”¨ï¼‰ã€‚

```solidity
contract ExternalCallDemo {
    uint256 public value;
    
    function externalFunc() external returns (uint256) {
        value += 1;
        return value;
    }
    
    function internalDemo() public returns (uint256) {
        // âŒ ä¸èƒ½ç›´æ¥è°ƒç”¨
        // return externalFunc();  // ç¼–è¯‘é”™è¯¯
        
        // âœ… å¯ä»¥é€šè¿‡thisè°ƒç”¨ï¼ˆä½†ä¼šå¢åŠ Gasï¼‰
        return this.externalFunc();  // è¿™æ˜¯ä¸€ä¸ªçœŸæ­£çš„å¤–éƒ¨è°ƒç”¨
    }
    
    // âš ï¸ æ³¨æ„ï¼šé€šè¿‡thisè°ƒç”¨ä¼šå¢åŠ çº¦2600 Gasçš„å¼€é”€
    // å¦‚æœéœ€è¦å†…éƒ¨è°ƒç”¨ï¼Œåº”è¯¥ä½¿ç”¨publicæˆ–internal
}
```

**ä¸ºä»€ä¹ˆäººä»¬å®¹æ˜“è¿™æ ·é”™ï¼Ÿ**

ç›´è§‰ä¸Šä¼šè®¤ä¸º"æˆ‘è‡ªå·±çš„å‡½æ•°ï¼Œæˆ‘å½“ç„¶èƒ½è°ƒç”¨"ï¼Œå¿½ç•¥äº†externalçš„è®¾è®¡æ„å›¾ã€‚

**æ­£ç¡®ç†è§£ï¼š**

```solidity
contract BestPractice {
    // å¦‚æœå‡½æ•°éœ€è¦è¢«å†…éƒ¨å’Œå¤–éƒ¨è°ƒç”¨
    // æ–¹æ¡ˆ1ï¼šä½¿ç”¨public
    function bothWays(uint256 x) public pure returns (uint256) {
        return x * 2;
    }
    
    // æ–¹æ¡ˆ2ï¼šæ‹†åˆ†ä¸ºinternal+external
    function externalEntry(uint256 x) external pure returns (uint256) {
        return _sharedLogic(x);
    }
    
    function _sharedLogic(uint256 x) internal pure returns (uint256) {
        return x * 2;
    }
    
    function internalCaller(uint256 x) public pure returns (uint256) {
        return _sharedLogic(x);  // å†…éƒ¨è°ƒç”¨
    }
}
```

---

### è¯¯åŒº3ï¼špublicæ€»æ˜¯æ¯”externalæ›´å¥½ï¼ˆåŠŸèƒ½æ›´å¤šï¼‰âŒ

**ä¸ºä»€ä¹ˆé”™ï¼Ÿ**

è™½ç„¶publicå¯ä»¥å†…å¤–è°ƒç”¨ï¼Œä½†å®ƒæœ‰ä¸€ä¸ªé‡è¦ç¼ºç‚¹ï¼š**å¼•ç”¨ç±»å‹å‚æ•°å¿…é¡»ç”¨memory**ï¼Œæ¯”calldataæ›´è€—Gasã€‚

```solidity
contract GasComparison {
    // external + calldataï¼šæœ€çœGas
    function processExternal(uint256[] calldata data) external pure returns (uint256) {
        uint256 sum = 0;
        for (uint i = 0; i < data.length; i++) {
            sum += data[i];
        }
        return sum;
    }
    // è°ƒç”¨æˆæœ¬ï¼š~2,500 Gas (100ä¸ªå…ƒç´ )
    
    // public + memoryï¼šæ›´è´µ
    function processPublic(uint256[] memory data) public pure returns (uint256) {
        uint256 sum = 0;
        for (uint i = 0; i < data.length; i++) {
            sum += data[i];
        }
        return sum;
    }
    // è°ƒç”¨æˆæœ¬ï¼š~4,000 Gas (100ä¸ªå…ƒç´ )
    
    // å·®å¼‚çº¦ 30-50%ï¼
}
```

**ä¸ºä»€ä¹ˆäººä»¬å®¹æ˜“è¿™æ ·é”™ï¼Ÿ**

ç›´è§‰ä¸Š"åŠŸèƒ½è¶Šå¤šè¶Šå¥½"ï¼Œå¿½ç•¥äº†Gasæˆæœ¬æ˜¯æ™ºèƒ½åˆçº¦å¼€å‘çš„é‡è¦è€ƒé‡ã€‚

**æ­£ç¡®ç†è§£ï¼š**

```
é€‰æ‹©åŸåˆ™ï¼š
1. åªå¯¹å¤–å¼€æ”¾ â†’ externalï¼ˆæœ€çœGasï¼‰
2. éœ€è¦å†…éƒ¨è°ƒç”¨ â†’ public æˆ– internal + externalç»„åˆ
3. ä¸è¦ä¸ºäº†"ä»¥é˜²ä¸‡ä¸€"ä½¿ç”¨public
```

---

## 7. ã€å®æˆ˜ä»£ç ã€‘

### åŸºç¡€å®ç°ï¼šå¯è§æ€§å®Œæ•´æ¼”ç¤º

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

/// @title å‡½æ•°å¯è§æ€§å®Œæ•´æ¼”ç¤º
/// @notice å±•ç¤ºå››ç§å¯è§æ€§çš„æ­£ç¡®ä½¿ç”¨åœºæ™¯
contract VisibilityDemo {
    
    // ========== çŠ¶æ€å˜é‡ ==========
    
    address public owner;              // è‡ªåŠ¨ç”Ÿæˆgetter
    uint256 internal totalDeposits;    // å­åˆçº¦å¯è®¿é—®
    mapping(address => uint256) private balances;  // ä»…æœ¬åˆçº¦
    
    // ========== äº‹ä»¶ ==========
    
    event Deposited(address indexed user, uint256 amount);
    event Withdrawn(address indexed user, uint256 amount);
    
    // ========== æ„é€ å‡½æ•° ==========
    
    constructor() {
        owner = msg.sender;
    }
    
    // ========== PUBLICå‡½æ•° ==========
    // é€‚ç”¨ï¼šéœ€è¦å†…éƒ¨å’Œå¤–éƒ¨éƒ½èƒ½è°ƒç”¨çš„å‡½æ•°
    
    /// @notice è·å–ç”¨æˆ·ä½™é¢
    function balanceOf(address user) public view returns (uint256) {
        return balances[user];
    }
    
    /// @notice è·å–åˆçº¦æ€»ä½™é¢
    function totalBalance() public view returns (uint256) {
        return address(this).balance;
    }
    
    // ========== EXTERNALå‡½æ•° ==========
    // é€‚ç”¨ï¼šåªå¯¹å¤–éƒ¨è°ƒç”¨è€…å¼€æ”¾çš„æ¥å£
    
    /// @notice å­˜æ¬¾
    function deposit() external payable {
        require(msg.value > 0, "Must deposit something");
        
        balances[msg.sender] += msg.value;
        totalDeposits += msg.value;
        
        emit Deposited(msg.sender, msg.value);
    }
    
    /// @notice å–æ¬¾
    function withdraw(uint256 amount) external {
        require(balances[msg.sender] >= amount, "Insufficient balance");
        
        balances[msg.sender] -= amount;
        
        (bool success, ) = msg.sender.call{value: amount}("");
        require(success, "Transfer failed");
        
        emit Withdrawn(msg.sender, amount);
    }
    
    /// @notice æ‰¹é‡æŸ¥è¯¢ä½™é¢ï¼ˆä½¿ç”¨calldataä¼˜åŒ–ï¼‰
    function batchBalanceOf(address[] calldata users) external view returns (uint256[] memory) {
        uint256[] memory result = new uint256[](users.length);
        for (uint i = 0; i < users.length; i++) {
            result[i] = balances[users[i]];
        }
        return result;
    }
    
    // ========== INTERNALå‡½æ•° ==========
    // é€‚ç”¨ï¼šæœ¬åˆçº¦å’Œå­åˆçº¦å…±äº«çš„é€»è¾‘
    
    /// @notice éªŒè¯ç”¨æˆ·æœ‰è¶³å¤Ÿä½™é¢
    function _hasEnoughBalance(address user, uint256 amount) internal view returns (bool) {
        return balances[user] >= amount;
    }
    
    /// @notice å†…éƒ¨è½¬è´¦
    function _transfer(address from, address to, uint256 amount) internal {
        require(_hasEnoughBalance(from, amount), "Insufficient balance");
        
        balances[from] -= amount;
        balances[to] += amount;
    }
    
    // ========== PRIVATEå‡½æ•° ==========
    // é€‚ç”¨ï¼šä»…æœ¬åˆçº¦ä½¿ç”¨ï¼Œä¸å¸Œæœ›è¢«ç»§æ‰¿çš„é€»è¾‘
    
    /// @notice æ£€æŸ¥æ˜¯å¦æ˜¯ownerï¼ˆç§æœ‰è¾…åŠ©å‡½æ•°ï¼‰
    function _isOwner(address account) private view returns (bool) {
        return account == owner;
    }
    
    /// @notice Ownerä¸“ç”¨ææ¬¾
    function ownerWithdraw(uint256 amount) external {
        require(_isOwner(msg.sender), "Not owner");
        require(amount <= address(this).balance, "Insufficient contract balance");
        
        (bool success, ) = owner.call{value: amount}("");
        require(success, "Transfer failed");
    }
}

/// @title å­åˆçº¦æ¼”ç¤ºç»§æ‰¿
contract ChildVault is VisibilityDemo {
    
    /// @notice å±•ç¤ºå­åˆçº¦å¯ä»¥è®¿é—®çš„å†…å®¹
    function childDemo() public view returns (
        address _owner,
        uint256 _totalDeposits,
        bool _hasBalance
    ) {
        // âœ… publicå˜é‡å¯è®¿é—®
        _owner = owner;
        
        // âœ… internalå˜é‡å¯è®¿é—®
        _totalDeposits = totalDeposits;
        
        // âœ… internalå‡½æ•°å¯è°ƒç”¨
        _hasBalance = _hasEnoughBalance(msg.sender, 1 ether);
        
        // âŒ privateå˜é‡ä¸å¯è®¿é—®
        // balances[msg.sender];  // ç¼–è¯‘é”™è¯¯
        
        // âŒ privateå‡½æ•°ä¸å¯è°ƒç”¨
        // _isOwner(msg.sender);  // ç¼–è¯‘é”™è¯¯
    }
    
    /// @notice å­åˆçº¦å¯ä»¥æ‰©å±•internalå‡½æ•°
    function transferBetweenUsers(address from, address to, uint256 amount) external {
        // ä½¿ç”¨ç»§æ‰¿çš„internalå‡½æ•°
        _transfer(from, to, amount);
    }
}

/// @title å¤–éƒ¨è°ƒç”¨è€…åˆçº¦
contract ExternalCaller {
    VisibilityDemo public vault;
    
    constructor(address _vault) {
        vault = VisibilityDemo(_vault);
    }
    
    /// @notice å±•ç¤ºå¤–éƒ¨åˆçº¦å¯ä»¥è°ƒç”¨çš„å†…å®¹
    function externalCallerDemo() public view returns (
        address _owner,
        uint256 _balance,
        uint256 _totalBalance
    ) {
        // âœ… publicå˜é‡å¯è®¿é—®ï¼ˆé€šè¿‡è‡ªåŠ¨ç”Ÿæˆçš„getterï¼‰
        _owner = vault.owner();
        
        // âœ… publicå‡½æ•°å¯è°ƒç”¨
        _balance = vault.balanceOf(msg.sender);
        _totalBalance = vault.totalBalance();
        
        // âœ… externalå‡½æ•°å¯è°ƒç”¨ï¼ˆçœç•¥ï¼‰
        // vault.deposit{value: 1 ether}();
        
        // âŒ internalå‡½æ•°ä¸å¯è®¿é—®
        // vault._hasEnoughBalance(msg.sender, 1);
        
        // âŒ privateå‡½æ•°ä¸å¯è®¿é—®
        // vault._isOwner(msg.sender);
    }
}
```

---

### è¿›é˜¶ï¼šGasä¼˜åŒ–å¯¹æ¯”

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

/// @title Gasä¼˜åŒ–å¯¹æ¯”æ¼”ç¤º
contract GasOptimizationDemo {
    
    // ===== EXTERNAL + CALLDATAï¼ˆæ¨èï¼‰=====
    
    function sumExternal(uint256[] calldata numbers) external pure returns (uint256 total) {
        for (uint i = 0; i < numbers.length; i++) {
            total += numbers[i];
        }
    }
    // Gasæ¶ˆè€—ï¼ˆ100ä¸ªå…ƒç´ ï¼‰: ~2,500
    
    // ===== PUBLIC + MEMORY =====
    
    function sumPublic(uint256[] memory numbers) public pure returns (uint256 total) {
        for (uint i = 0; i < numbers.length; i++) {
            total += numbers[i];
        }
    }
    // Gasæ¶ˆè€—ï¼ˆ100ä¸ªå…ƒç´ ï¼‰: ~4,000
    
    // ===== Gaså¯¹æ¯”æµ‹è¯• =====
    
    function compareGas(uint256[] calldata data) external view returns (
        uint256 externalGas,
        uint256 publicGas
    ) {
        uint256 gasBefore;
        uint256 gasAfter;
        
        // æµ‹è¯•external + calldata
        gasBefore = gasleft();
        this.sumExternal(data);
        gasAfter = gasleft();
        externalGas = gasBefore - gasAfter;
        
        // æµ‹è¯•public + memory (éœ€è¦å¤åˆ¶æ•°æ®)
        uint256[] memory memoryCopy = data;  // å…ˆå¤åˆ¶åˆ°memory
        gasBefore = gasleft();
        sumPublic(memoryCopy);
        gasAfter = gasleft();
        publicGas = gasBefore - gasAfter;
    }
}

/// @title å®é™…é¡¹ç›®ä¸­çš„æœ€ä½³å®è·µ
contract BestPractices {
    
    mapping(address => uint256) private balances;
    
    // ===== æ¨¡å¼1ï¼šæ‹†åˆ†internal + external =====
    // å½“é€»è¾‘éœ€è¦è¢«å†…éƒ¨å¤ç”¨æ—¶
    
    function transfer(address to, uint256 amount) external {
        _transfer(msg.sender, to, amount);
    }
    
    function _transfer(address from, address to, uint256 amount) internal {
        require(balances[from] >= amount, "Insufficient");
        balances[from] -= amount;
        balances[to] += amount;
    }
    
    // å†…éƒ¨å¯ä»¥å¤ç”¨_transfer
    function batchTransfer(
        address[] calldata recipients,
        uint256[] calldata amounts
    ) external {
        require(recipients.length == amounts.length, "Length mismatch");
        for (uint i = 0; i < recipients.length; i++) {
            _transfer(msg.sender, recipients[i], amounts[i]);
        }
    }
    
    // ===== æ¨¡å¼2ï¼šçº¯å¤–éƒ¨æ¥å£ç”¨external =====
    
    function deposit() external payable {
        balances[msg.sender] += msg.value;
    }
    
    // ===== æ¨¡å¼3ï¼šæŸ¥è¯¢å‡½æ•°é€šå¸¸ç”¨public =====
    // å› ä¸ºå¯èƒ½éœ€è¦åœ¨å…¶ä»–å‡½æ•°ä¸­è°ƒç”¨
    
    function balanceOf(address account) public view returns (uint256) {
        return balances[account];
    }
    
    function totalValue() public view returns (uint256) {
        // å†…éƒ¨è°ƒç”¨balanceOf
        return balanceOf(address(this)) + address(this).balance;
    }
}
```

---

## 8. ã€é¢è¯•å¿…é—®ã€‘

### é—®é¢˜1ï¼š"Solidityå››ç§å¯è§æ€§æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿä»€ä¹ˆæ—¶å€™ç”¨å“ªä¸ªï¼Ÿ"

**æ™®é€šå›ç­”ï¼ˆâŒ ä¸å‡ºå½©ï¼‰ï¼š**

"publicä»»ä½•äººéƒ½èƒ½è°ƒç”¨ï¼Œexternalåªèƒ½å¤–éƒ¨è°ƒç”¨ï¼Œinternalæœ¬åˆçº¦å’Œå­åˆçº¦ï¼Œprivateåªæœ‰æœ¬åˆçº¦ã€‚ä¸€èˆ¬å‡½æ•°ç”¨publicå°±è¡Œã€‚"

**å‡ºå½©å›ç­”ï¼ˆâœ… æ¨èï¼‰ï¼š**

> **å››ç§å¯è§æ€§çš„æ ¸å¿ƒåŒºåˆ«åœ¨äºè°ƒç”¨èŒƒå›´å’ŒGasæ•ˆç‡ï¼š**
>
> **1. public**
> - è°ƒç”¨èŒƒå›´ï¼šå¤–éƒ¨ï¼ˆEOAã€åˆçº¦ï¼‰+ å†…éƒ¨ï¼ˆæœ¬åˆçº¦ã€å­åˆçº¦ï¼‰
> - å‚æ•°é™åˆ¶ï¼šå¼•ç”¨ç±»å‹å¿…é¡»ç”¨memory
> - ä½¿ç”¨åœºæ™¯ï¼šéœ€è¦å†…éƒ¨å’Œå¤–éƒ¨éƒ½èƒ½è°ƒç”¨çš„å‡½æ•°ï¼Œå¦‚`balanceOf()`
>
> **2. external**
> - è°ƒç”¨èŒƒå›´ï¼šä»…å¤–éƒ¨è°ƒç”¨
> - å‚æ•°ä¼˜åŠ¿ï¼šå¯ä»¥ç”¨calldataï¼Œ**Gasæ›´çœ**ï¼ˆæ¯”publicçœ30-50%ï¼‰
> - ä½¿ç”¨åœºæ™¯ï¼šçº¯å¯¹å¤–æ¥å£ï¼Œå¦‚`deposit()`ã€`withdraw()`
>
> **3. internal**
> - è°ƒç”¨èŒƒå›´ï¼šæœ¬åˆçº¦ + å­åˆçº¦å†…éƒ¨
> - ä½¿ç”¨åœºæ™¯ï¼šå…±äº«çš„è¾…åŠ©é€»è¾‘ï¼Œå¦‚`_transfer()`ã€`_mint()`
> - å‘½åæƒ¯ä¾‹ï¼šé€šå¸¸ä»¥ä¸‹åˆ’çº¿å¼€å¤´
>
> **4. private**
> - è°ƒç”¨èŒƒå›´ï¼šä»…æœ¬åˆçº¦
> - ä½¿ç”¨åœºæ™¯ï¼šä¸å¸Œæœ›è¢«ç»§æ‰¿çš„å®ç°ç»†èŠ‚
> - **é‡è¦æ³¨æ„**ï¼šprivateä¸ä»£è¡¨æ•°æ®éšè—ï¼é“¾ä¸Šæ•°æ®ä»ç„¶å…¬å¼€å¯è¯»
>
> **é€‰æ‹©åŸåˆ™ï¼š**
> ```
> åªå¯¹å¤–éƒ¨å¼€æ”¾ â†’ externalï¼ˆæœ€çœGasï¼‰
> å†…å¤–éƒ½éœ€è¦è°ƒç”¨ â†’ public
> æœ¬åˆçº¦+å­åˆçº¦å…±äº« â†’ internal
> ä»…æœ¬åˆçº¦ä½¿ç”¨ â†’ private
> ```
>
> **å®é™…é¡¹ç›®ä¸­çš„æœ€ä½³å®è·µï¼š**
> - ERC20çš„`transfer()`ç”¨externalï¼Œ`balanceOf()`ç”¨public
> - å†…éƒ¨é€»è¾‘æŠ½å–ä¸ºinternalå‡½æ•°ï¼Œexternalå‡½æ•°è°ƒç”¨internal
> - æ•æ„Ÿæ“ä½œç”¨private + modifierä¿æŠ¤

**ä¸ºä»€ä¹ˆè¿™ä¸ªå›ç­”å‡ºå½©ï¼Ÿ**
1. âœ… ç»“æ„åŒ–å¯¹æ¯”å››ç§å¯è§æ€§
2. âœ… æåˆ°äº†Gaså·®å¼‚è¿™ä¸ªå…³é”®ç‚¹
3. âœ… ç»™å‡ºäº†å®é™…ä½¿ç”¨åœºæ™¯
4. âœ… æé†’äº†privateçš„å®‰å…¨è¯¯åŒº

---

### é—®é¢˜2ï¼š"ä¸ºä»€ä¹ˆexternalæ¯”publicæ›´çœGasï¼Ÿ"

**æ™®é€šå›ç­”ï¼ˆâŒ ä¸å‡ºå½©ï¼‰ï¼š**

"å› ä¸ºexternalå¯ä»¥ç”¨calldataï¼Œpublicåªèƒ½ç”¨memoryã€‚calldataæ›´ä¾¿å®œã€‚"

**å‡ºå½©å›ç­”ï¼ˆâœ… æ¨èï¼‰ï¼š**

> **externalæ›´çœGasçš„åŸå› æ¶‰åŠEVMçš„è°ƒç”¨æœºåˆ¶ï¼š**
>
> **1. å‚æ•°ä¼ é€’æ–¹å¼ä¸åŒ**
> - **external**ï¼šå‚æ•°å¯ä»¥ç›´æ¥ç”¨`calldata`ï¼Œè¿™æ˜¯å¯¹äº¤æ˜“è¾“å…¥æ•°æ®çš„ç›´æ¥å¼•ç”¨ï¼Œ**é›¶æ‹·è´**
> - **public**ï¼šå‚æ•°å¿…é¡»ç”¨`memory`ï¼Œå› ä¸ºpublicå‡½æ•°å¯èƒ½è¢«å†…éƒ¨è°ƒç”¨ï¼Œè€Œå†…éƒ¨è°ƒç”¨æ—¶å‚æ•°åœ¨æ ˆ/memoryä¸­ï¼Œä¸æ˜¯calldata
>
> **2. æ•°æ®å¤åˆ¶å¼€é”€**
> ```solidity
> // externalï¼šç›´æ¥è¯»å–calldataï¼Œæ— å¤åˆ¶
> function sumExternal(uint256[] calldata data) external pure { }
> 
> // publicï¼šå‚æ•°ä»calldataå¤åˆ¶åˆ°memory
> function sumPublic(uint256[] memory data) public pure { }
> ```
>
> **3. å…·ä½“Gasæ•°æ®**
> - 100ä¸ªuint256æ•°ç»„ï¼š
>   - external + calldataï¼šçº¦2,500 Gas
>   - public + memoryï¼šçº¦4,000 Gas
>   - **å·®å¼‚çº¦60%**
>
> **4. ä¸ºä»€ä¹ˆpublicä¸èƒ½ç”¨calldataï¼Ÿ**
> ```solidity
> function publicFunc(uint256[] calldata data) public { }  // âŒ ç¼–è¯‘é”™è¯¯
> 
> // å› ä¸ºinternalè°ƒç”¨æ—¶ï¼š
> function caller() public {
>     uint256[] memory arr = new uint256[](3);
>     publicFunc(arr);  // arråœ¨memoryä¸­ï¼Œä¸æ˜¯calldata
>     // å¦‚æœpublicFuncè¦æ±‚calldataï¼Œè¿™é‡Œæ— æ³•æ»¡è¶³
> }
> ```
>
> **å®é™…å»ºè®®ï¼š**
> - çº¯å¯¹å¤–æ¥å£ï¼šä¼˜å…ˆä½¿ç”¨external + calldata
> - éœ€è¦å†…éƒ¨å¤ç”¨ï¼šä½¿ç”¨internalå‡½æ•° + externalåŒ…è£…

**ä¸ºä»€ä¹ˆè¿™ä¸ªå›ç­”å‡ºå½©ï¼Ÿ**
1. âœ… è§£é‡Šäº†åº•å±‚æœºåˆ¶
2. âœ… æä¾›äº†å…·ä½“Gasæ•°æ®
3. âœ… è¯´æ˜äº†ä¸ºä»€ä¹ˆpublicä¸èƒ½ç”¨calldata
4. âœ… ç»™å‡ºäº†å®é™…å»ºè®®

---

## 9. ã€åŒ–éª¨ç»µæŒã€‘

### å¡ç‰‡1ï¼šç›´è§‰ç†è§£ - å¯è§æ€§æ˜¯ä»€ä¹ˆï¼Ÿ ğŸ¯

**ä¸€å¥è¯ï¼š** å¯è§æ€§å†³å®šäº†"è°èƒ½è°ƒç”¨è¿™ä¸ªå‡½æ•°"ï¼Œå°±åƒé—¨ç¦å†³å®šè°èƒ½è¿›å“ªä¸ªæˆ¿é—´ã€‚

**ä¸¾ä¾‹ï¼š**
```
public    = å¤§å ‚ï¼ˆæ‰€æœ‰äººï¼‰
external  = è®¿å®¢ä¼šè®®å®¤ï¼ˆä»…å¤–éƒ¨ï¼‰
internal  = åŠå…¬åŒºï¼ˆå‘˜å·¥+å­å…¬å¸ï¼‰
private   = CEOåŠå…¬å®¤ï¼ˆä»…CEOï¼‰
```

**åº”ç”¨ï¼š** é€‰æ‹©æ­£ç¡®çš„å¯è§æ€§æ˜¯å®‰å…¨æ€§å’ŒGasä¼˜åŒ–çš„åŸºç¡€ã€‚

---

### å¡ç‰‡2ï¼šå½¢å¼åŒ–å®šä¹‰ - å››ç§å¯è§æ€§ ğŸ“

**ä¸€å¥è¯ï¼š** public/external/internal/privateæ§åˆ¶å‡½æ•°çš„è°ƒç”¨èŒƒå›´ã€‚

| å¯è§æ€§ | å¤–éƒ¨è°ƒç”¨ | å†…éƒ¨è°ƒç”¨ | å­åˆçº¦ |
|-------|---------|---------|--------|
| public | âœ… | âœ… | âœ… |
| external | âœ… | âŒ* | âŒ |
| internal | âŒ | âœ… | âœ… |
| private | âŒ | âœ… | âŒ |

*å¯ä»¥ç”¨`this.func()`è°ƒç”¨

**åº”ç”¨ï¼š** ç†è§£è¿™ä¸ªè¡¨æ ¼æ˜¯æ­£ç¡®ä½¿ç”¨å¯è§æ€§çš„å‰æã€‚

---

### å¡ç‰‡3ï¼šå…³é”®æ¦‚å¿µ - public ğŸ”“

**ä¸€å¥è¯ï¼š** publicå‡½æ•°ä»»ä½•äººéƒ½èƒ½è°ƒç”¨ï¼ŒåŒ…æ‹¬å¤–éƒ¨ç”¨æˆ·ã€å…¶ä»–åˆçº¦ã€æœ¬åˆçº¦å’Œå­åˆçº¦ã€‚

**ä¸¾ä¾‹ï¼š**
```solidity
function balanceOf(address account) public view returns (uint256) {
    return balances[account];
}

// å¤–éƒ¨è°ƒç”¨ï¼šcontract.balanceOf(user)
// å†…éƒ¨è°ƒç”¨ï¼šbalanceOf(user)
```

**åº”ç”¨ï¼š** æŸ¥è¯¢å‡½æ•°ã€éœ€è¦å†…å¤–éƒ½èƒ½è°ƒç”¨çš„åŠŸèƒ½ç”¨publicã€‚

---

### å¡ç‰‡4ï¼šå…³é”®æ¦‚å¿µ - external âš¡

**ä¸€å¥è¯ï¼š** externalå‡½æ•°åªèƒ½ä»å¤–éƒ¨è°ƒç”¨ï¼Œå‚æ•°å¯ç”¨calldataï¼ŒGasæœ€çœã€‚

**ä¸¾ä¾‹ï¼š**
```solidity
// å‚æ•°ç”¨calldataï¼ŒçœGas
function deposit(bytes calldata data) external payable {
    // å¤„ç†å­˜æ¬¾
}

// å†…éƒ¨ä¸èƒ½ç›´æ¥è°ƒç”¨
// deposit(data);  // âŒ
// this.deposit(data);  // âœ… ä½†æµªè´¹Gas
```

**åº”ç”¨ï¼š** çº¯å¯¹å¤–æ¥å£ç”¨externalï¼Œå¦‚deposit()ã€withdraw()ã€‚

---

### å¡ç‰‡5ï¼šå…³é”®æ¦‚å¿µ - internal ğŸ 

**ä¸€å¥è¯ï¼š** internalå‡½æ•°åªèƒ½åœ¨æœ¬åˆçº¦å’Œå­åˆçº¦å†…éƒ¨è°ƒç”¨ï¼Œé€‚åˆå…±äº«é€»è¾‘ã€‚

**ä¸¾ä¾‹ï¼š**
```solidity
function _transfer(address from, address to, uint256 amount) internal {
    balances[from] -= amount;
    balances[to] += amount;
}

// å¤–éƒ¨ä¸èƒ½è°ƒç”¨
// contract._transfer(...)  // âŒ
```

**åº”ç”¨ï¼š** è¾…åŠ©å‡½æ•°ã€å­åˆçº¦éœ€è¦å¤ç”¨çš„é€»è¾‘ç”¨internalï¼Œé€šå¸¸ä»¥_å¼€å¤´ã€‚

---

### å¡ç‰‡6ï¼šå…³é”®æ¦‚å¿µ - private ğŸ”’

**ä¸€å¥è¯ï¼š** privateå‡½æ•°åªèƒ½åœ¨æœ¬åˆçº¦å†…éƒ¨è°ƒç”¨ï¼Œå­åˆçº¦éƒ½ä¸èƒ½è®¿é—®ã€‚

**ä¸¾ä¾‹ï¼š**
```solidity
function _validateOwner() private view returns (bool) {
    return msg.sender == owner;
}

// å­åˆçº¦ä¸èƒ½è®¿é—®
contract Child is Parent {
    // _validateOwner();  // âŒ
}
```

**åº”ç”¨ï¼š** ä¸å¸Œæœ›è¢«ç»§æ‰¿è¦†ç›–çš„å®ç°ç»†èŠ‚ç”¨privateã€‚

---

### å¡ç‰‡7ï¼šè¿›é˜¶ç†è§£ - Gaså¯¹æ¯” â›½

**ä¸€å¥è¯ï¼š** external + calldataæ¯”public + memoryèŠ‚çœçº¦30-50% Gasã€‚

**ä¸¾ä¾‹ï¼š**
```solidity
// ~2,500 Gas
function sumExt(uint256[] calldata data) external pure returns (uint256) {}

// ~4,000 Gas  
function sumPub(uint256[] memory data) public pure returns (uint256) {}
```

**åº”ç”¨ï¼š** é«˜é¢‘è°ƒç”¨çš„å¯¹å¤–å‡½æ•°ï¼Œä½¿ç”¨externalå¯æ˜¾è‘—é™ä½ç”¨æˆ·æˆæœ¬ã€‚

---

### å¡ç‰‡8ï¼šé«˜çº§åº”ç”¨ - ç»§æ‰¿ä¸é‡å†™ ğŸ§¬

**ä¸€å¥è¯ï¼š** public/external/internalå¯ä»¥ç”¨virtual/overrideé‡å†™ï¼Œprivateä¸èƒ½è¢«ç»§æ‰¿ã€‚

**ä¸¾ä¾‹ï¼š**
```solidity
contract Parent {
    function foo() public virtual returns (uint) { return 1; }
}

contract Child is Parent {
    function foo() public override returns (uint) { return 2; }
}
```

**åº”ç”¨ï¼š** è®¾è®¡å¯æ‰©å±•åˆçº¦æ—¶ï¼Œinternalå‡½æ•°æ˜¯å­åˆçº¦å®šåˆ¶è¡Œä¸ºçš„å…¥å£ã€‚

---

### å¡ç‰‡9ï¼šå®‰å…¨è­¦ç¤º - privateä¸æ˜¯éšè— âš ï¸

**ä¸€å¥è¯ï¼š** privateåªé™åˆ¶åˆçº¦çº§åˆ«è®¿é—®ï¼Œé“¾ä¸Šæ•°æ®ä»ç„¶å…¬å¼€å¯è¯»ï¼

**ä¸¾ä¾‹ï¼š**
```javascript
// "private"å˜é‡å¯ä»¥è¢«ç›´æ¥è¯»å–
const secret = await provider.getStorageAt(
    contractAddress,
    0  // slotå·
);
console.log(parseInt(secret, 16));  // è¾“å‡ºç§æœ‰å˜é‡å€¼
```

**åº”ç”¨ï¼š** ä¸è¦ç”¨privateå­˜å‚¨çœŸæ­£éœ€è¦ä¿å¯†çš„æ•°æ®ï¼Œä½¿ç”¨å¯†ç å­¦æ–¹æ¡ˆï¼ˆå“ˆå¸Œã€åŠ å¯†ï¼‰ã€‚

---

### å¡ç‰‡10ï¼šæ€»ç»“ä¸å»¶ä¼¸ ğŸ“

**ä¸€å¥è¯ï¼š** å¯è§æ€§æ˜¯æ™ºèƒ½åˆçº¦è®¿é—®æ§åˆ¶çš„åŸºç¡€ï¼Œé€‰æ‹©åˆé€‚çš„å¯è§æ€§å…³ä¹å®‰å…¨å’Œæ•ˆç‡ã€‚

**æ ¸å¿ƒè¦ç‚¹ï¼š**
1. public = ä»»ä½•äºº
2. external = ä»…å¤–éƒ¨ï¼ˆæœ€çœGasï¼‰
3. internal = å®¶æ—å†…éƒ¨
4. private = ä»…è‡ªå·±
5. private â‰  æ•°æ®éšè—

**ä¸‹ä¸€æ­¥å­¦ä¹ ï¼š**
- modifierä¿®é¥°å™¨ï¼ˆæƒé™æ§åˆ¶ï¼‰
- msg.sender/msg.valueï¼ˆè°ƒç”¨ä¸Šä¸‹æ–‡ï¼‰
- åˆçº¦ç»§æ‰¿ä¸æ¥å£
- è®¿é—®æ§åˆ¶æœ€ä½³å®è·µï¼ˆOpenZeppelinï¼‰

---

## 10. ã€ä¸€å¥è¯æ€»ç»“ã€‘

**å‡½æ•°å¯è§æ€§é€šè¿‡publicï¼ˆä»»ä½•äººï¼‰ã€externalï¼ˆä»…å¤–éƒ¨ï¼‰ã€internalï¼ˆæœ¬åˆçº¦+å­åˆçº¦ï¼‰ã€privateï¼ˆä»…æœ¬åˆçº¦ï¼‰å››ä¸ªçº§åˆ«æ§åˆ¶å‡½æ•°çš„è°ƒç”¨èŒƒå›´ï¼Œå…¶ä¸­externalé…åˆcalldataå¯å®ç°æœ€ä¼˜Gasæ•ˆç‡ï¼Œæ˜¯æ™ºèƒ½åˆçº¦å®‰å…¨è®¾è®¡å’Œæ€§èƒ½ä¼˜åŒ–çš„åŸºç¡€ã€‚**

---

## ğŸ“š é™„å½•

### å­¦ä¹ æ£€æŸ¥æ¸…å•

å®Œæˆæœ¬çŸ¥è¯†ç‚¹å­¦ä¹ åï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

- [ ] è¯´å‡ºå››ç§å¯è§æ€§çš„è°ƒç”¨èŒƒå›´
- [ ] è§£é‡Šä¸ºä»€ä¹ˆexternalæ¯”publicæ›´çœGas
- [ ] æ­£ç¡®é€‰æ‹©å‡½æ•°çš„å¯è§æ€§çº§åˆ«
- [ ] ç†è§£ç»§æ‰¿æ—¶å¯è§æ€§çš„è¡Œä¸º
- [ ] çŸ¥é“privateä¸ä»£è¡¨æ•°æ®éšè—
- [ ] ä½¿ç”¨internalå‡½æ•°å®ç°ä»£ç å¤ç”¨

### å¿«é€Ÿå‚è€ƒå¡

**å¯è§æ€§é€‰æ‹©é€ŸæŸ¥ï¼š**

```solidity
// çº¯å¯¹å¤–æ¥å£ â†’ external
function deposit() external payable { }

// å†…å¤–éƒ½éœ€è¦ â†’ public
function balanceOf(address a) public view returns (uint256) { }

// å†…éƒ¨å…±äº«é€»è¾‘ â†’ internal
function _transfer(address f, address t, uint256 a) internal { }

// ä¸æƒ³è¢«ç»§æ‰¿ â†’ private
function _checkOwner() private view { }
```

**çŠ¶æ€å˜é‡å¯è§æ€§ï¼š**

```solidity
uint256 public value;      // è‡ªåŠ¨ç”Ÿæˆgetter
uint256 internal count;    // å­åˆçº¦å¯è®¿é—®ï¼ˆé»˜è®¤ï¼‰
uint256 private secret;    // ä»…æœ¬åˆçº¦ï¼ˆæ•°æ®ä»å…¬å¼€ï¼ï¼‰
```

### ä¸‹ä¸€æ­¥å­¦ä¹ 

æ¨èæŒ‰ä»¥ä¸‹é¡ºåºç»§ç»­å­¦ä¹ ï¼š

1. **msg.sender/msg.value** - ç†è§£è°ƒç”¨ä¸Šä¸‹æ–‡
2. **modifier** - å‡½æ•°ä¿®é¥°å™¨ä¸æƒé™æ§åˆ¶
3. **ç»§æ‰¿ä¸æ¥å£** - åˆçº¦å¤ç”¨ä¸æ ‡å‡†åŒ–
4. **OpenZeppelinè®¿é—®æ§åˆ¶** - ç”Ÿäº§çº§æƒé™ç®¡ç†

---

**ç‰ˆæœ¬ï¼š** v1.0
**åˆ›å»ºæ—¥æœŸï¼š** 2025-12-07
**ä½œè€…ï¼š** Web3å­¦ä¹ åŠ©æ‰‹
**é€‚ç”¨äººç¾¤ï¼š** å‰ç«¯å·¥ç¨‹å¸ˆè½¬Web3å¼€å‘
